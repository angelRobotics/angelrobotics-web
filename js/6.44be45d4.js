(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"007b":function(e,t,i){"use strict";i.r(t);class s{constructor(){}_destroy(){this.self.enableExternalControls=!1}}t["default"]=s},"02ed":function(e,t,i){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},"1d4c":function(e,t,i){"use strict";i("7db8")},"3b13":function(e){e.exports=JSON.parse('{"Agriculture":"Farm work"}')},"5d57":function(e,t,i){"use strict";i.r(t),i.d(t,"simulator",(function(){return n})),i.d(t,"statemanager",(function(){return d})),i.d(t,"settings",(function(){return b})),i.d(t,"status",(function(){return g})),i.d(t,"auth",(function(){return f})),i.d(t,"scene",(function(){return w})),i.d(t,"state",(function(){return T})),i.d(t,"farmbot",(function(){return A})),i.d(t,"angelBot",(function(){return C}));var s=i("76a8");class n{constructor(e={}){this.canvas=e.canvas,this.events=e.events,this.engine=new s["Engine"](this.canvas,!0,{preserveDrawingBuffer:!0,stencil:!0})}}var a=i("9523"),o=i.n(a),r=(i("ddb0"),i("13d5"),i("b3d6")),l=i.n(r),m=i("bc3a"),c=i.n(m),h=i("1712");class d{constructor(e={}){o()(this,"botInstances",{}),this.events=e.events,this.debug=e.debug||!1,this.port=e.port||8787,this.uptime=0,this.timer=null,this.broker=null,this.token=null,this.botId=null,this.deviceOnline=!1,this.otherClients=!1,this.mqttStatus=!1,this.userEnv={},this.location={x:0,y:0,z:0}}stopTimerRunTimer(){try{this.uptime=0,clearInterval(this.timer)}catch(e){}this.timer=setInterval((()=>{this.uptime++}),1e3)}async connectMQTT(){let e=JSON.parse(window.localStorage.getItem("farmbotSimulator")).status,{broker:t,token:i,botId:s}=e;return t=`wss://${t}:443/ws/mqtt`,console.log(`bot/${s}/#`),console.log({broker:t,token:i,botId:s}),this.broker=t,this.token=i,this.botId=s,new Promise(((e,n)=>{const a=l.a.connect(t,{clean:!0,password:i,protocolId:"MQIsdp",protocolVersion:3,username:s});console.log(s),console.log(s),console.log(s),a.on("error",(function(e){console.log("Can't connect"+e),n(e)})),a.on("connect",(async()=>{a.subscribe(`bot/${s}/#`,{qos:1}),e(a)}))}))}async delay(e){return new Promise(((t,i)=>{setTimeout((()=>t(!0)),e)}))}setMqttStatus(e){e!==this.mqttStatus&&(this.mqttStatus=e,this.events.emit("mqtt",e?"online":"offline"))}sendPingPong(e,t){this.client.publish(`bot/${this.botId}/${t}/${e}`,e.toString())}setDeviceStatus(e,t){switch(t){case"deviceOnline":this.deviceOnline=e,this.events.emit("status",{Device:e});break;case"otherClients":this.otherClients=e,this.events.emit("status",{"Other Clients":e});break;default:}}async scheduleMonitorDeviceStatus(){let e=[],t=[],i=[],s=[],n=2e3,a=n,o=1e4,r=2e3,l=0,m=0,c=0,d=[],u=[],p={},[b,g]=await Object(h["default"])(this.connectMQTT());if(b)throw b;let _=g;setInterval((()=>{let e=(new Date).getTime();e-l>=n&&(d.push(e),this.sendPingPong(e,"ping"))}),n),setInterval((()=>{let e=(new Date).getTime();for(let t in p){let i=parseInt(t),s=p[t];e-i>=a&&(u.push(parseInt(s)),this.sendPingPong(s,"pong"))}}),a),setInterval((()=>{e.length>.5*t.length?this.setDeviceStatus(!0,"otherClients"):this.setDeviceStatus(!1,"otherClients"),i.length>.5*s.length?this.setDeviceStatus(!0,"deviceOnline"):this.setDeviceStatus(!1,"deviceOnline"),t=[],e=[],s=[],i=[]}),o),setInterval((()=>{let e=(new Date).getTime();e-c>5*r&&this.setMqttStatus(!1)}),r),_.on("message",((n,a)=>{try{a=a.toString();let o=n.split("/")[2];switch(c=(new Date).getTime(),this.setMqttStatus(!0),o){case"ping":if(l=(new Date).getTime(),d.includes(parseInt(a))){t.push(l);let e=d.indexOf(a);d.splice(e,1)}else e.push(l),this.sendPingPong(a,"pong"),u.push(parseInt(msgData));p[l]=a;break;case"pong":if(m=(new Date).getTime(),u.includes(parseInt(a))){s.push(m);let e=u.indexOf(a);u.splice(e,1)}else i.push(m);for(let e in p){let t=p[e];t===a&&delete p[e]}break}}catch(b){}}))}async startOrRestartSimulator(){this.stopTimerRunTimer();let e=setInterval((()=>{this.events.emit("mqtt","waiting for connection")}),1e3),[t,i]=await Object(h["default"])(this.connectMQTT());if(t)throw t;clearInterval(e),this.client=i,this.monitorMQTT(),this.events.emit("mqtt","connected"),this.scheduleMonitorDeviceStatus(),this.schedulePublishTelemetry(),this.schedulePublishLogs(),this.schedulePublishStatusMessage(),this.monitorDownlinkMessages()}monitorMQTT(){this.client;this.events.on("mqtt",(e=>{"offline"===e&&this.events.emit("status",{mqtt:!1}),"online"===e&&this.events.emit("status",{mqtt:!0}),console.log("listener:",e)}))}publishFromDevice(e){let t={args:{label:e.label},kind:"rpc_ok"};this.publishGeneralData(t,"from_device")}setUserEnv(e){for(let t in e){let i=e[t].kind;switch(i){case"pair":let i=e[t].args;this.userEnv[i.label]=i.value;break}}}linearPath(e,t,i){console.log(e,t,i);let s=0,n=e.map((e=>[t[s++],e])),a=n.map((e=>e[0]-e[1])),o=Math.sqrt(a.map((e=>e*e)).reduce(((e,t)=>e+t))),r=o/i,l=a.map((e=>e/r));return{distance:o,time:r,speeds:l}}setPosition(e){let[t,i,s]=e,n=!1;t===this.location.x&&i===this.location.y&&s===this.location.z||(n=!0),this.location.x=t,this.location.y=i,this.location.z=s,n&&(console.log("LOCATION",[t,i,s]),this.events.emit("location",[t,i,s]))}async moveBot(e,t){return new Promise(((i,s)=>{let{distance:n,time:a,speeds:o}=e,r=[this.location.x,this.location.y,this.location.z],l=0,m=16,c=setInterval((()=>{let e=0;l+=m;let t=r.map((t=>t+o[e++]*l/1e3));this.setPosition(t),this.publishStatusMessage()}),m),h=1e3*a;setTimeout((()=>{clearInterval(c);let e=0;r.map((t=>t+o[e++]*h/1e3));this.setPosition(t),this.publishStatusMessage(),i(!0)}),h)}))}async moveRelative(e,t){let{x:i,y:s,z:n,speed:a}=e,o=[i,s,n],r={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:`Moving relative to (${o[0]},${o[1]},${o[2]})`,meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"info",verbosity:2,x:this.location.x,y:this.location.y,z:this.location.z};console.log(r),this.publishGeneralData(r,"logs");let l=[this.location.x,this.location.y,this.location.z],m=[...o],c=0;m=m.map((e=>l[c++]+e));let h=this.linearPath(l,m,a);await this.moveBot(h,m),this.publishFromDevice(t)}async moveAbsolute(e,t){let i=e.offset.args,s=e.location.args,n=e.speed,a=[s.x,s.y,s.z];s=[s.x,s.y,s.z],i=[i.x,i.y,i.z];let o=[this.location.x,this.location.y,this.location.z];for(let m in i)i[m]!==o[m]&&(i[m]=o[m]);let r={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:`Moving to (${a[0]},${a[1]},${a[2]})`,meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"info",verbosity:2,x:this.location.x,y:this.location.y,z:this.location.z};console.log(r),this.publishGeneralData(r,"logs");let l=this.linearPath(i,s,n);console.log(l);for(let m in this.botInstances)this.botInstances[m].moveAbsolute(a);await this.moveBot(l,s),this.publishFromDevice(t)}async processRpcRequests(e,t){for(let i in e){let s=e[i].kind;switch(s){case"set_user_env":this.setUserEnv(e[i].body),this.publishFromDevice(t);break;case"move_absolute":this.moveAbsolute(e[i].args,t);break;case"move_relative":this.moveRelative(e[i].args,t);break}}}async processFromClientTopicMessages(e,t){try{t=decodeURIComponent(t)}catch(a){}try{t=JSON.parse(t)}catch(a){}console.log(t);let i=t.kind,s=t.body,n=t.args;switch(console.log(i),console.log(s),i){case"rpc_request":this.processRpcRequests(s,n);break}}processSyncMessages(e,t){let i=e.split("/")[3];switch(i){case"FarmwareEnv":this.publishFromDevice(t.args);break;case"Device":this.publishFromDevice(t.args),this.deviceSync=t.body;break}}monitorDownlinkMessages(){let e=this.client;e.on("message",((e,t)=>{try{let i=e.split("/")[2];switch(i){case"from_clients":this.processFromClientTopicMessages(e,t);break;case"sync":this.processSyncMessages(e,t);break}}catch(i){}}))}publishGeneralData(e,t){"object"===typeof e&&(e=JSON.stringify(e)),this.client.publish(`bot/${this.botId}/${t}`,e)}schedulePublishLogs(){let e={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:"Farmbot is up and running!",meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"success",verbosity:1,x:this.location.x,y:this.location.y,z:this.location.z};this.publishGeneralData(e,"logs")}schedulePublishTelemetry(){let e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"interface_configure","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:140,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"9ff8173c-5fe2-4b50-b2db-da38ad52ecc4","telemetry.value":null};this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"reset","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:reset_ntp, 0}",line:358,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"ntp","telemetry.uuid":"95ea2925-53e7-4e3c-a4f5-227cefe99eb6","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"interface_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:181,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"621e5ee8-0d71-4f79-b5ec-6b67253f5908","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"lan_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:196,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"a94eb734-bfa8-4664-8e39-e47aba534c4b","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"connection_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:handle_info, 2}",line:120,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker"},"telemetry.subsystem":"amqp","telemetry.uuid":"b0acda3b-8e27-438f-aa36-c65e08a5dc93","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/log_channel.ex",function:"{:handle_info, 2}",line:43,module:"Elixir.FarmbotExt.AMQP.LogChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"7b6b7de5-d2f7-469d-afa6-72b8cd065c1c","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"lan_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:196,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"6d150eb5-0c03-46d9-b17d-bd668711af05","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/telemetry_channel.ex",function:"{:handle_info, 2}",line:58,module:"Elixir.FarmbotExt.AMQP.TelemetryChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"550154f8-93ef-4fb4-8efe-72fc9f9f30bb","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/bot_state_channel.ex",function:"{:handle_info, 2}",line:57,module:"Elixir.FarmbotExt.AMQP.BotStateChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"dbace292-522f-4ce5-a0d9-d70869693a1a","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={telemetry_captured_at:(new Date).toISOString(),telemetry_cpu_usage:6,telemetry_disk_usage:0,telemetry_memory_usage:44,telemetry_scheduler_usage:6,telemetry_soc_temp:50,telemetry_target:"rpi3",telemetry_throttled:"0x0",telemetry_uptime:this.uptime,telemetry_wifi_level:-39,telemetry_wifi_level_percent:90},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/ping_pong_channel.ex",function:"{:handle_info, 2}",line:73,module:"Elixir.FarmbotExt.AMQP.PingPongChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"fa9183a8-8829-4f67-a743-45a2bb54c38c","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/celery_script_channel.ex",function:"{:handle_info, 2}",line:53,module:"Elixir.FarmbotExt.AMQP.CeleryScriptChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"97d452cf-e39b-4deb-aad2-7256757aec9a","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/celery_script_channel.ex",function:"{:handle_info, 2}",line:54,module:"Elixir.FarmbotExt.AMQP.CeleryScriptChannel",queue_name:`${this.botId}_from_clients`,routing_key:`bot.${this.botId}.from_clients`},"telemetry.subsystem":"amqp","telemetry.uuid":"f5b25e2a-5593-4163-bc01-f9c34cb75cf2","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/ping_pong_channel.ex",function:"{:handle_info, 2}",line:75,module:"Elixir.FarmbotExt.AMQP.PingPongChannel",queue_name:`${this.botId}_ping`,routing_key:`bot.${this.botId}.ping.#`},"telemetry.subsystem":"amqp","telemetry.uuid":"3ca9da32-0812-43e1-a809-482b98708562","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:maybe_connect, 4}",line:62,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker"},"telemetry.subsystem":"amqp","telemetry.uuid":"2f2988a2-f290-4e1d-b396-8723cd417e81","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:maybe_connect, 4}",line:63,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker",queue_name:`${this.botId}_auto_sync`,routing_key:`bot.${this.botId}.sync.#`},"telemetry.subsystem":"amqp","telemetry.uuid":"4d265203-176c-4ff5-8748-4523382a6a00","telemetry.value":null},setInterval((()=>{let e={telemetry_captured_at:(new Date).toISOString(),telemetry_cpu_usage:2,telemetry_disk_usage:0,telemetry_memory_usage:53,telemetry_scheduler_usage:2,telemetry_soc_temp:41,telemetry_target:"rpi3",telemetry_throttled:"0x0",telemetry_uptime:this.uptime,telemetry_wifi_level:-39,telemetry_wifi_level_percent:90};this.publishGeneralData(e,"telemetry")}),3e5)}publishStatusMessage(){let e={configuration:{arduino_debug_messages:!1,auto_sync:!1,beta_opt_in:!1,disable_factory_reset:!1,firmware_debug_log:!1,firmware_hardware:"farmduino_k14",firmware_input_log:!1,firmware_output_log:!1,network_not_found_timer:null,os_auto_update:!1,sequence_body_log:!1,sequence_complete_log:!1,sequence_init_log:!1},informational_settings:{busy:!1,cache_bust:null,commit:"1c5ef14bfa90cbbaff792f3a14c7c0707c73bb08",controller_commit:"1c5ef14bfa90cbbaff792f3a14c7c0707c73bb08",controller_uuid:"29417194-a853-55ef-6de8-91dd9b849b0b",controller_version:"10.1.4",cpu_usage:3,disk_usage:0,env:"prod",firmware_commit:"1711db1d9923bc295f81a5eb9952f6b3a10db6a9",firmware_version:"6.4.2.G",idle:!0,last_status:null,locked:!1,memory_usage:60,node_name:"farmbot@farmbot-000000004ed75c64.local",private_ip:"192.168.100.30",scheduler_usage:3,soc_temp:34,sync_status:"sync_now",target:"rpi3",throttled:"0x0",update_available:!0,uptime:this.uptime,wifi_level:-37,wifi_level_percent:91},jobs:{},location_data:{axis_states:{x:"unknown",y:"unknown",z:"unknown"},load:{x:null,y:null,z:null},position:{x:this.location.x,y:this.location.y,z:this.location.z},raw_encoders:{x:0,y:0,z:0},scaled_encoders:{x:0,y:0,z:0}},mcu_params:{movement_stall_sensitivity_z:30,movement_stop_at_max_y:0,encoder_missed_steps_max_y:5,movement_keep_active_y:1,movement_steps_acc_dec_y:300,movement_invert_2_endpoints_y:0,movement_keep_active_z:1,movement_max_spd_y:400,pin_guard_5_time_out:60,encoder_scaling_z:5556,pin_guard_4_pin_nr:0,pin_guard_3_time_out:60,movement_steps_acc_dec_x:300,encoder_missed_steps_decay_z:5,movement_home_up_x:0,movement_secondary_motor_invert_x:1,encoder_enabled_y:1,movement_axis_nr_steps_x:0,movement_motor_current_x:600,movement_timeout_x:120,movement_invert_endpoints_x:0,movement_home_spd_y:50,encoder_enabled_z:1,movement_enable_endpoints_z:0,movement_home_at_boot_y:0,movement_axis_nr_steps_z:0,movement_invert_motor_x:0,encoder_invert_z:0,movement_home_spd_z:50,encoder_type_y:0,movement_enable_endpoints_y:0,pin_guard_3_active_state:1,encoder_scaling_y:5556,movement_stop_at_max_x:0,encoder_missed_steps_decay_x:5,movement_timeout_z:120,encoder_scaling_x:5556,movement_keep_active_x:1,movement_min_spd_y:50,movement_max_spd_x:400,movement_stop_at_max_z:0,encoder_missed_steps_max_x:5,pin_guard_1_active_state:1,movement_home_up_z:1,encoder_missed_steps_decay_y:5,pin_guard_1_time_out:60,movement_step_per_mm_x:5,movement_home_at_boot_x:0,movement_invert_2_endpoints_z:0,movement_home_spd_x:50,pin_guard_4_active_state:1,movement_stall_sensitivity_x:30,encoder_type_x:0,movement_min_spd_z:50,pin_guard_3_pin_nr:0,pin_guard_2_pin_nr:0,pin_guard_5_active_state:1,pin_guard_2_active_state:1,movement_motor_current_y:600,movement_home_up_y:0,movement_axis_nr_steps_y:0,movement_stall_sensitivity_y:30,movement_invert_endpoints_z:0,movement_home_at_boot_z:0,movement_microsteps_y:1,pin_guard_1_pin_nr:0,movement_invert_motor_z:0,pin_guard_4_time_out:60,encoder_use_for_pos_x:0,pin_guard_5_pin_nr:0,encoder_invert_x:0,movement_step_per_mm_y:5,movement_invert_2_endpoints_x:0,encoder_use_for_pos_y:0,movement_invert_motor_y:0,movement_microsteps_x:1,param_mov_nr_retry:3,movement_min_spd_x:50,movement_invert_endpoints_y:0,movement_steps_acc_dec_z:300,movement_max_spd_z:400,movement_stop_at_home_z:0,param_e_stop_on_mov_err:0,movement_enable_endpoints_x:0,encoder_enabled_x:1,movement_microsteps_z:1,encoder_missed_steps_max_z:5,encoder_invert_y:0,pin_guard_2_time_out:60,movement_step_per_mm_z:25,encoder_type_z:0,movement_timeout_y:120,movement_secondary_motor_x:1,movement_stop_at_home_x:0,movement_motor_current_z:600,movement_stop_at_home_y:0,encoder_use_for_pos_z:0},pins:{},process_info:{farmwares:{}},user_env:{LAST_CLIENT_CONNECTED:this.userEnv.LAST_CLIENT_CONNECTED||'"2020-08-25T06:28:44.168Z"',camera:'"USB"'}};this.publishGeneralData(e,"status")}schedulePublishStatusMessage(){setInterval((()=>{this.publishStatusMessage()}),5e3)}}let u={farmbot:{genesis:{genesis:{length:3e3,width:1500,height:500},xl:{length:6e3,width:3e3,height:500}},express:{express:{length:3e3,width:1200,height:500},xl:{length:6e3,width:2400,height:500}},juakali:{custom:{length:1e4,width:2e3,height:1500}},mega:{"2R":{point0:[0,0],point1:[-100,1e4],point2:[900,9e3],point3:[1e3,100],height:2500},"4R":{point0:[0,0],point1:[-100,1e4],point2:[900,9e3],point3:[1e3,100],height:2500}}},port:8787},p={botType:"express",subType:"xl",port:u.port};class b{constructor(e={}){this.events=e.events,this.saveDefaults(),this.botOptions=u}saveDefaults(){let e={};try{e=JSON.parse(window.localStorage.getItem("farmbotSimulator"))}catch(i){e={}}e||(e={}),void 0===e.settings&&(e.settings={});for(let s in p){let t=p[s];void 0===e.settings[s]&&(e.settings[s]=t)}if(void 0===e.values){e.values={};let t=u.farmbot[e.settings.botType][e.settings.subType];e.values=t}if(0===Object.keys(e.values).length){let t=u.farmbot[e.settings.botType][e.settings.subType];e.values=t}let t=JSON.stringify(e);window.localStorage.setItem("farmbotSimulator",t)}getSettings(){let e={};try{e=JSON.parse(window.localStorage.getItem("farmbotSimulator"))}catch(i){e={}}void 0===e.settings&&(e.settings={});let t={};return t.settings=e.settings,t.values=e.values,t.options=JSON.parse(JSON.stringify(u)),t}writeSettings(e,t){let i=["length","width","height"],s=["point0","point1","point2","point3"],n=!1;for(let l in t){let e=t[l];if(i.includes(l)){let i=parseInt(e);isNaN(i)?n=!0:t[l]=i}let a=[];s.includes(l)&&(a="string"===typeof e?e.split(","):e,a=a.map((e=>{let t=parseInt(e);if(!isNaN(t))return t;n=!0})),2!==a.length&&(n=!0),t[l]=a)}if(n)return!1;let a={};try{a=JSON.parse(window.localStorage.getItem("farmbotSimulator"))}catch(r){a={}}a.settings=e,a.values=t;let o=JSON.stringify(a);return window.localStorage.setItem("farmbotSimulator",o),!0}}class g{constructor(e={}){this.events=e.events,this.status={Device:!1,"Other Clients":!1,Mathematica:!1,mqtt:!1},this.events.on("status",(e=>{this.processStatus(e)}))}processStatus(e){if("object"!==typeof e)return!1;for(let t in e){let i=e[t];this.status[t]=i}}getStatus(){return this.status}}const _="https://my.farmbot.io/api";class y{constructor(){}async checkTokenAndRefresh(){let e={};return new Promise((async(t,i)=>{try{if(e=JSON.parse(window.localStorage.getItem("farmbotSimulator")).status,void 0===e)throw"missing token"}catch(o){return i("missing token")}let s=e.token;if(null===s)return i("missing token");let n={"content-type":"application/json",Authorization:`Bearer ${s}`},a={},[o,r]=await Object(h["default"])(c.a.get(`${_}/tokens`,{params:a,headers:n}));if(o)return i(o);this.setStatus({token:r.data.token.encoded}),this.refreshTokenData(),t(!0)}))}setStatus(e){let t={};try{t=JSON.parse(window.localStorage.getItem("farmbotSimulator"))||{}}catch(i){t={}}void 0===t.status&&(t.status={});for(let s in e)t.status[s]=e[s];t=JSON.stringify(t),window.localStorage.setItem("farmbotSimulator",t)}async logIn(e){return new Promise((async(t,i)=>{let[s,n]=await Object(h["default"])(c.a.post(`${_}/tokens`,{user:e}));return s?i(s.response.data.auth||s):(this.loggedIn(n.data),t(n.data))}))}loggedIn(e){let t=e.token;console.log(t);let i=t.encoded,s=t.unencoded.mqtt,n=t.unencoded.bot;this.setStatus({token:i,broker:s,botId:n,user:e.user}),this.refreshTokenData()}logout(){try{let e=JSON.parse(window.localStorage.getItem("farmbotSimulator")),t={};for(let i in e)"status"!==i&&(t[i]=e[i]);t=JSON.stringify(t),window.localStorage.setItem("farmbotSimulator",t),this.refreshTokenData()}catch(e){}}refreshTokenData(){let e=JSON.parse(window.localStorage.getItem("farmbotSimulator")).status,{broker:t,token:i,botId:s}=e;this.broker=t,this.token=i,this.botId=s}}const f=new y;i("5319");const x={"2d":"2D","3dconly":"Light 3D","3dbab":"Heavy 3D"};class v{constructor(){}allScenes(){return Object.values(x)}defaultScene(){let e=this.allScenes();return e[0]}setScene(e){window.localStorage.setItem("farmbotSimulator-scene",e)}getScene(){let e;try{e=window.localStorage.getItem("farmbotSimulator-scene")||!1}catch(t){}return e||(e=this.defaultScene(),this.setScene(e)),e}addRule(e,t){const i=(e,t)=>{let i=[];for(let n=0;n<document.styleSheets.length;n++){let a=document.styleSheets[n];const o=a.cssRules;let r,l=(t?e+"{"+t+"}":e).replace(/\s/g,""),m=t?"cssText":"selectorText";for(r=0;r<o.length;r++)try{let e=new RegExp(l.replace(/\(/g,"\\(").replace(/\)/g,"\\)"),"g");o[r][m].match(e)&&i.push([a,r,o[r][m]])}catch(s){}}return i};let s=i(e);s.map((([e,i,s])=>{let n="string"===typeof t?t:Object.keys(t).map((function(e){return e+":"+("content"===e?"'"+t[e]+"'":t[e])})).join(";");e.deleteRule(i),e.insertRule(s+"{"+n+"}",e.cssRules.length)}))}}const w=new v;var B=i("faa1"),k=i.n(B);const S="https://my.farmbot.io/api",O={device:"device",points:"points",savedGardens:"saved_gardens",regimens:"regimens",sequences:"sequences"};class M extends k.a{constructor(){super(),o()(this,"botInstances",{}),this.uptime=0,this.timer=null,this.broker=null,this.token=null,this.botId=null,this.deviceOnline=!1,this.otherClients=!1,this.mqttStatus=!1,this.userEnv={},this.location={x:0,y:0,z:0},this.status={mqtt:"waiting"},this.refreshTokenData()}getToken(){return this.token}async startOrRestartSimulator(){this.refreshTokenData(),this.stopTimerRunTimer(),this.emit("status",{message:"mqtt waiting for connection"}),this.status.mqtt="waiting";let[e,t]=await Object(h["default"])(this.connectMQTT());if(e)throw e;this.client=t,this.emit("status",{type:"positive",message:"mqtt connected"}),this.status.mqtt="connected",this.scheduleMonitorDeviceStatus(),this.schedulePublishTelemetry(),this.schedulePublishLogs(),this.schedulePublishStatusMessage(),this.monitorDownlinkMessages()}headers(){let e={Authorization:`Bearer ${this.token}`,"content-type":"application/json"};return{headers:e}}async savedGardens(){return new Promise((async(e,t)=>{let[i,s]=await Object(h["default"])(c.a.get(`${S}/saved_gardens`,this.headers()));if(i)return t(i);e(s.data)}))}async points(){return new Promise((async(e,t)=>{let[i,s]=await Object(h["default"])(c.a.get(`${S}/points`,this.headers()));if(i)return t(i);e(s.data)}))}async farmbotGET(e){return new Promise((async(t,i)=>{let s=O[e];s||(s=e.replace(/([a-z])([A-Z])/,((e,t,i,s,n)=>t+"_"+i.toLowerCase())));let[n,a]=await Object(h["default"])(c.a.get(`${S}/${s}`,this.headers()));if(n)return i(n);t(a.data)}))}async farmbotPOST(e,t){return new Promise((async(i,s)=>{let n=O[e];n||(n=e.replace(/([a-z])([A-Z])/,((e,t,i,s,n)=>t+"_"+i.toLowerCase())));let[a,o]=await Object(h["default"])(c.a.post(`${S}/${n}`,t,this.headers()));if(a)return s(a);i(o.data)}))}async deleteDevice(){return new Promise((async(e,t)=>{let[i,s]=await Object(h["default"])(this.farmbotGET("device"));if(i)return t(i);let n=s,a=(new Date).toISOString();n.last_saw_api=a,[i,s]=await Object(h["default"])(this.farmbotPOST("device",n)),[i,s]=await Object(h["default"])(this.farmbotGET("device")),e(s)}))}async fixDeviceAPI(){return new Promise((async(e,t)=>{let[i,s]=await Object(h["default"])(this.farmbotGET("device"));if(console.log("device",s),console.log(i),i)return t(i);let n=s,a=(new Date).toISOString();console.log(a,typeof a),n.last_saw_api=a,[i,s]=await Object(h["default"])(this.farmbotPOST("device",n)),console.log(i),console.log(s),[i,s]=await Object(h["default"])(this.farmbotGET("device")),console.log(i),console.log(s),e(s)}))}refreshTokenData(){let e=(JSON.parse(window.localStorage.getItem("farmbotSimulator"))||{}).status||{},{broker:t,token:i,botId:s}=e;this.broker=t,this.token=i,this.botId=s}removeAllListeners(){try{this.client.end()}catch(e){}}stopTimerRunTimer(){try{this.uptime=0,clearInterval(this.timer)}catch(e){}this.timer=setInterval((()=>{this.uptime++}),1e3)}async connectMQTT(){let e=JSON.parse(window.localStorage.getItem("farmbotSimulator")).status,{broker:t,token:i,botId:s}=e;return t=`wss://${t}:443/ws/mqtt`,console.log({broker:t,token:i,botId:s}),new Promise(((e,n)=>{const a=l.a.connect(t,{clean:!0,password:i,protocolId:"MQIsdp",protocolVersion:3,username:s});a.on("error",(function(e){console.log("Can't connect"+e),n(e)})),a.on("connect",(async()=>{a.subscribe(`bot/${this.botId}/#`,{qos:1}),e(a)}))}))}async delay(e){return new Promise(((t,i)=>{setTimeout((()=>t(!0)),e)}))}setMqttStatus(e){e!==this.mqttStatus&&(this.mqttStatus=e,this.events.emit("mqtt",e?"online":"offline"))}sendPingPong(e,t){this.client.publish(`bot/${this.botId}/${t}/${e}`,e.toString())}setDeviceStatus(e,t){switch(t){case"deviceOnline":this.deviceOnline=e,this.emit("status",` Device: ${e}`);break;case"otherClients":this.otherClients=e,this.emit("status",` Other Clients: ${e}`);break;default:}}async scheduleMonitorDeviceStatus(){let e=[],t=[],i=[],s=[],n=2e3,a=n,o=1e4,r=2e3,l=0,m=0,c=0,d=[],u=[],p={},[b,g]=await Object(h["default"])(this.connectMQTT());if(b)throw b;let _=g;setInterval((()=>{let e=(new Date).getTime();e-l>=n&&(d.push(e),this.sendPingPong(e,"ping"))}),n),setInterval((()=>{let e=(new Date).getTime();for(let t in p){let i=parseInt(t),s=p[t];e-i>=a&&(u.push(parseInt(s)),this.sendPingPong(s,"pong"))}}),a),setInterval((()=>{e.length>.5*t.length?this.setDeviceStatus(!0,"otherClients"):this.setDeviceStatus(!1,"otherClients"),i.length>.5*s.length?this.setDeviceStatus(!0,"deviceOnline"):this.setDeviceStatus(!1,"deviceOnline"),t=[],e=[],s=[],i=[]}),o),setInterval((()=>{let e=(new Date).getTime();e-c>5*r&&this.setMqttStatus(!1)}),r),console.log("client"),console.log("client"),console.log(_),console.log("client"),_.on("message",((n,a)=>{try{a=a.toString();let o=n.split("/")[2];switch(c=(new Date).getTime(),this.setMqttStatus(!0),o){case"ping":if(l=(new Date).getTime(),d.includes(parseInt(a))){t.push(l);let e=d.indexOf(a);d.splice(e,1)}else e.push(l),this.sendPingPong(a,"pong"),u.push(parseInt(msgData));p[l]=a;break;case"pong":if(m=(new Date).getTime(),u.includes(parseInt(a))){s.push(m);let e=u.indexOf(a);u.splice(e,1)}else i.push(m);for(let e in p){let t=p[e];t===a&&delete p[e]}break}}catch(b){}}))}publishFromDevice(e){let t={args:{label:e.label},kind:"rpc_ok"};this.publishGeneralData(t,"from_device")}setUserEnv(e){for(let t in e){let i=e[t].kind;switch(i){case"pair":let i=e[t].args;this.userEnv[i.label]=i.value;break}}}linearPath(e,t,i){console.log(e,t,i);let s=0,n=e.map((e=>[t[s++],e])),a=n.map((e=>e[0]-e[1])),o=Math.sqrt(a.map((e=>e*e)).reduce(((e,t)=>e+t))),r=o/i,l=a.map((e=>e/r));return{distance:o,time:r,speeds:l}}setPosition(e){let[t,i,s]=e,n=!1;t===this.location.x&&i===this.location.y&&s===this.location.z||(n=!0),this.location.x=t,this.location.y=i,this.location.z=s}async moveBot(e,t){return new Promise(((e,t)=>e(!0)))}async moveRelative(e,t){let{x:i,y:s,z:n,speed:a}=e,o=[i,s,n],r={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:`Moving relative to (${o[0]},${o[1]},${o[2]})`,meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"info",verbosity:2,x:this.location.x,y:this.location.y,z:this.location.z};console.log(r),this.publishGeneralData(r,"logs");let l=[this.location.x,this.location.y,this.location.z],m=[...o];for(let d in this.botInstances)this.botInstances[d].moveRelative(m,(e=>{this.setPosition(e),this.publishStatusMessage()}));let c=0;m=m.map((e=>l[c++]+e));let h=this.linearPath(l,m,a);await this.moveBot(h,m),this.publishFromDevice(t)}async moveAbsolute(e,t){let i=e.offset.args,s=e.location.args,n=e.speed,a=[s.x,s.y,s.z];s=[s.x,s.y,s.z],i=[i.x,i.y,i.z];let o=[this.location.x,this.location.y,this.location.z];for(let m in i)i[m]!==o[m]&&(i[m]=o[m]);let r={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:`Moving to (${a[0]},${a[1]},${a[2]})`,meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"info",verbosity:2,x:this.location.x,y:this.location.y,z:this.location.z};this.publishGeneralData(r,"logs");let l=this.linearPath(i,s,n);for(let m in this.botInstances)this.botInstances[m].moveAbsolute(s,(e=>{this.setPosition(e),this.publishStatusMessage()}));await this.moveBot(l,s),this.publishFromDevice(t)}async move(e,t){let i=e.offset.args,s=e.location.args,n=e.speed,a=[s.x,s.y,s.z];s=[s.x,s.y,s.z],i=[i.x,i.y,i.z];let o=[this.location.x,this.location.y,this.location.z];for(let m in i)i[m]!==o[m]&&(i[m]=o[m]);let r={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:`Moving to (${a[0]},${a[1]},${a[2]})`,meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"info",verbosity:2,x:this.location.x,y:this.location.y,z:this.location.z};this.publishGeneralData(r,"logs");let l=this.linearPath(i,s,n);for(let m in this.botInstances)this.botInstances[m].moveAbsolute(s,(e=>{this.setPosition(e),this.publishStatusMessage()}));await this.moveBot(l,s),this.publishFromDevice(t)}async processRpcRequests(e,t){for(let i in e){let s=e[i].kind;switch(s){case"set_user_env":this.setUserEnv(e[i].body),this.publishFromDevice(t);break;case"move_absolute":this.moveAbsolute(e[i].args,t);break;case"move_relative":this.moveRelative(e[i].args,t);break;case"move":let s={offset:{kind:"coordinate",args:{x:0,y:0,z:0}},location:{kind:"coordinate",args:e[i].body[0].args.axis_operand.args}};this.moveAbsolute(s,t);break}}}async processFromClientTopicMessages(e,t){try{t=decodeURIComponent(t)}catch(a){}try{t=JSON.parse(t)}catch(a){}console.log(t);let i=t.kind,s=t.body,n=t.args;switch(console.log(i),console.log(s),i){case"rpc_request":this.processRpcRequests(s,n);break}}processSyncMessages(e,t){let i=e.split("/")[3];switch(i){case"FarmwareEnv":this.publishFromDevice(t.args);break;case"Device":this.publishFromDevice(t.args),this.deviceSync=t.body;break}}monitorDownlinkMessages(){let e=this.client;e.on("message",((e,t)=>{try{let i=e.split("/")[2];switch(i){case"from_clients":this.processFromClientTopicMessages(e,t);break;case"sync":this.processSyncMessages(e,t);break}}catch(i){}}))}publishGeneralData(e,t){"object"===typeof e&&(e=JSON.stringify(e)),this.client.publish(`bot/${this.botId}/${t}`,e)}schedulePublishLogs(){let e={channels:[],created_at:(new Date).getTime().toString().slice(0,10),major_version:10,message:"Farmbot is up and running!",meta:{assertion_passed:null,assertion_type:null},minor_version:1,patch_version:4,type:"success",verbosity:1,x:this.location.x,y:this.location.y,z:this.location.z};this.publishGeneralData(e,"logs")}schedulePublishTelemetry(){let e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"interface_configure","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:140,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"9ff8173c-5fe2-4b50-b2db-da38ad52ecc4","telemetry.value":null};this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"reset","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:reset_ntp, 0}",line:358,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"ntp","telemetry.uuid":"95ea2925-53e7-4e3c-a4f5-227cefe99eb6","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"interface_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:181,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"621e5ee8-0d71-4f79-b5ec-6b67253f5908","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"lan_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:196,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"a94eb734-bfa8-4664-8e39-e47aba534c4b","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"connection_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:handle_info, 2}",line:120,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker"},"telemetry.subsystem":"amqp","telemetry.uuid":"b0acda3b-8e27-438f-aa36-c65e08a5dc93","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/log_channel.ex",function:"{:handle_info, 2}",line:43,module:"Elixir.FarmbotExt.AMQP.LogChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"7b6b7de5-d2f7-469d-afa6-72b8cd065c1c","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"lan_connect","telemetry.meta":{file:"/nerves/build/farmbot_os/platform/target/network.ex",function:"{:handle_info, 2}",interface:"wlan0",line:196,module:"Elixir.FarmbotOS.Platform.Target.Network"},"telemetry.subsystem":"network","telemetry.uuid":"6d150eb5-0c03-46d9-b17d-bd668711af05","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/telemetry_channel.ex",function:"{:handle_info, 2}",line:58,module:"Elixir.FarmbotExt.AMQP.TelemetryChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"550154f8-93ef-4fb4-8efe-72fc9f9f30bb","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/bot_state_channel.ex",function:"{:handle_info, 2}",line:57,module:"Elixir.FarmbotExt.AMQP.BotStateChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"dbace292-522f-4ce5-a0d9-d70869693a1a","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={telemetry_captured_at:(new Date).toISOString(),telemetry_cpu_usage:6,telemetry_disk_usage:0,telemetry_memory_usage:44,telemetry_scheduler_usage:6,telemetry_soc_temp:50,telemetry_target:"rpi3",telemetry_throttled:"0x0",telemetry_uptime:this.uptime,telemetry_wifi_level:-39,telemetry_wifi_level_percent:90},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/ping_pong_channel.ex",function:"{:handle_info, 2}",line:73,module:"Elixir.FarmbotExt.AMQP.PingPongChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"fa9183a8-8829-4f67-a743-45a2bb54c38c","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/celery_script_channel.ex",function:"{:handle_info, 2}",line:53,module:"Elixir.FarmbotExt.AMQP.CeleryScriptChannel"},"telemetry.subsystem":"amqp","telemetry.uuid":"97d452cf-e39b-4deb-aad2-7256757aec9a","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/celery_script_channel.ex",function:"{:handle_info, 2}",line:54,module:"Elixir.FarmbotExt.AMQP.CeleryScriptChannel",queue_name:`${this.botId}_from_clients`,routing_key:`bot.${this.botId}.from_clients`},"telemetry.subsystem":"amqp","telemetry.uuid":"f5b25e2a-5593-4163-bc01-f9c34cb75cf2","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/ping_pong_channel.ex",function:"{:handle_info, 2}",line:75,module:"Elixir.FarmbotExt.AMQP.PingPongChannel",queue_name:`${this.botId}_ping`,routing_key:`bot.${this.botId}.ping.#`},"telemetry.subsystem":"amqp","telemetry.uuid":"3ca9da32-0812-43e1-a809-482b98708562","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"channel_open","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:maybe_connect, 4}",line:62,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker"},"telemetry.subsystem":"amqp","telemetry.uuid":"2f2988a2-f290-4e1d-b396-8723cd417e81","telemetry.value":null},this.publishGeneralData(e,"telemetry"),e={"telemetry.captured_at":(new Date).toISOString(),"telemetry.kind":"event","telemetry.measurement":"queue_bind","telemetry.meta":{file:"/nerves/build/farmbot_ext/lib/farmbot_ext/amqp/connection_worker.ex",function:"{:maybe_connect, 4}",line:63,module:"Elixir.FarmbotExt.AMQP.ConnectionWorker",queue_name:`${this.botId}_auto_sync`,routing_key:`bot.${this.botId}.sync.#`},"telemetry.subsystem":"amqp","telemetry.uuid":"4d265203-176c-4ff5-8748-4523382a6a00","telemetry.value":null},setInterval((()=>{let e={telemetry_captured_at:(new Date).toISOString(),telemetry_cpu_usage:2,telemetry_disk_usage:0,telemetry_memory_usage:53,telemetry_scheduler_usage:2,telemetry_soc_temp:41,telemetry_target:"rpi3",telemetry_throttled:"0x0",telemetry_uptime:this.uptime,telemetry_wifi_level:-39,telemetry_wifi_level_percent:90};this.publishGeneralData(e,"telemetry")}),3e5)}publishStatusMessage(){let e={configuration:{arduino_debug_messages:!1,auto_sync:!1,beta_opt_in:!1,disable_factory_reset:!1,firmware_debug_log:!1,firmware_hardware:"farmduino_k14",firmware_input_log:!1,firmware_output_log:!1,network_not_found_timer:null,os_auto_update:!1,sequence_body_log:!1,sequence_complete_log:!1,sequence_init_log:!1},informational_settings:{busy:!1,cache_bust:null,commit:"1c5ef14bfa90cbbaff792f3a14c7c0707c73bb08",controller_commit:"1c5ef14bfa90cbbaff792f3a14c7c0707c73bb08",controller_uuid:"29417194-a853-55ef-6de8-91dd9b849b0b",controller_version:"10.1.4",cpu_usage:3,disk_usage:0,env:"prod",firmware_commit:"1711db1d9923bc295f81a5eb9952f6b3a10db6a9",firmware_version:"6.4.2.G",idle:!0,last_status:null,locked:!1,memory_usage:60,node_name:"farmbot@farmbot-000000004ed75c64.local",private_ip:"192.168.100.30",scheduler_usage:3,soc_temp:34,sync_status:"sync_now",target:"rpi3",throttled:"0x0",update_available:!0,uptime:this.uptime,wifi_level:-37,wifi_level_percent:91},jobs:{},location_data:{axis_states:{x:"unknown",y:"unknown",z:"unknown"},load:{x:null,y:null,z:null},position:{x:this.location.x,y:this.location.y,z:this.location.z},raw_encoders:{x:0,y:0,z:0},scaled_encoders:{x:0,y:0,z:0}},mcu_params:{movement_stall_sensitivity_z:30,movement_stop_at_max_y:0,encoder_missed_steps_max_y:5,movement_keep_active_y:1,movement_steps_acc_dec_y:300,movement_invert_2_endpoints_y:0,movement_keep_active_z:1,movement_max_spd_y:400,pin_guard_5_time_out:60,encoder_scaling_z:5556,pin_guard_4_pin_nr:0,pin_guard_3_time_out:60,movement_steps_acc_dec_x:300,encoder_missed_steps_decay_z:5,movement_home_up_x:0,movement_secondary_motor_invert_x:1,encoder_enabled_y:1,movement_axis_nr_steps_x:0,movement_motor_current_x:600,movement_timeout_x:120,movement_invert_endpoints_x:0,movement_home_spd_y:50,encoder_enabled_z:1,movement_enable_endpoints_z:0,movement_home_at_boot_y:0,movement_axis_nr_steps_z:0,movement_invert_motor_x:0,encoder_invert_z:0,movement_home_spd_z:50,encoder_type_y:0,movement_enable_endpoints_y:0,pin_guard_3_active_state:1,encoder_scaling_y:5556,movement_stop_at_max_x:0,encoder_missed_steps_decay_x:5,movement_timeout_z:120,encoder_scaling_x:5556,movement_keep_active_x:1,movement_min_spd_y:50,movement_max_spd_x:400,movement_stop_at_max_z:0,encoder_missed_steps_max_x:5,pin_guard_1_active_state:1,movement_home_up_z:1,encoder_missed_steps_decay_y:5,pin_guard_1_time_out:60,movement_step_per_mm_x:5,movement_home_at_boot_x:0,movement_invert_2_endpoints_z:0,movement_home_spd_x:50,pin_guard_4_active_state:1,movement_stall_sensitivity_x:30,encoder_type_x:0,movement_min_spd_z:50,pin_guard_3_pin_nr:0,pin_guard_2_pin_nr:0,pin_guard_5_active_state:1,pin_guard_2_active_state:1,movement_motor_current_y:600,movement_home_up_y:0,movement_axis_nr_steps_y:0,movement_stall_sensitivity_y:30,movement_invert_endpoints_z:0,movement_home_at_boot_z:0,movement_microsteps_y:1,pin_guard_1_pin_nr:0,movement_invert_motor_z:0,pin_guard_4_time_out:60,encoder_use_for_pos_x:0,pin_guard_5_pin_nr:0,encoder_invert_x:0,movement_step_per_mm_y:5,movement_invert_2_endpoints_x:0,encoder_use_for_pos_y:0,movement_invert_motor_y:0,movement_microsteps_x:1,param_mov_nr_retry:3,movement_min_spd_x:50,movement_invert_endpoints_y:0,movement_steps_acc_dec_z:300,movement_max_spd_z:400,movement_stop_at_home_z:0,param_e_stop_on_mov_err:0,movement_enable_endpoints_x:0,encoder_enabled_x:1,movement_microsteps_z:1,encoder_missed_steps_max_z:5,encoder_invert_y:0,pin_guard_2_time_out:60,movement_step_per_mm_z:25,encoder_type_z:0,movement_timeout_y:120,movement_secondary_motor_x:1,movement_stop_at_home_x:0,movement_motor_current_z:600,movement_stop_at_home_y:0,encoder_use_for_pos_z:0},pins:{},process_info:{farmwares:{}},user_env:{LAST_CLIENT_CONNECTED:this.userEnv.LAST_CLIENT_CONNECTED||'"2020-08-25T06:28:44.168Z"',camera:'"USB"'}};this.publishGeneralData(e,"status")}schedulePublishStatusMessage(){setInterval((()=>{this.publishStatusMessage()}),5e3)}}const T=new M;var L=i("4d6f");class P{constructor(){}connect(){let e=T.getToken(),t=new L["Farmbot"]({token:e});t.connect()}}const A=new P;var N=i("ded3"),I=i.n(N);i("26e9");const{MixMaterial:Y}=i("dd4a"),z=i("8d5f").default;class D{constructor(){o()(this,"instances",{}),o()(this,"hadstarted",!1),o()(this,"numInstances",0),o()(this,"initHandler",(()=>{this.hadstarted=!0;this.vueObj.$refs.botsElement})),o()(this,"botTypes",(()=>i("60a8"))),o()(this,"applications",(()=>i("3b13"))),o()(this,"unloadScene",(e=>{})),o()(this,"changeBotType",(e=>{let t=this.instances[e];if(!t.botType||!t.botTypeType)return;let i=`${t.botType}${t.botTypeType}`;switch(i=i.toUpperCase().replace(/ /g,""),console.log(i),console.log(i),console.log(i),console.log(i),console.log(i),i){case"FARMBOTGENESIS":case"FARMBOTGENESISXL":case"FARMBOTEXPRESS":case"FARMBOTEXPRESSXL":t.bed=!0,t.workSpaceLength=this.botTypes()[t.botType][t.botTypeType].Length,t.workSpaceWidth=this.botTypes()[t.botType][t.botTypeType].Width,this.createGardenSoil(e);break;case"ANGELBOTGROUNDCABLE":case"ANGELBOTGROUNDRAIL":case"ANGELBOTAERIALCABLE":case"ANGELBOTAERIALRAIL":this.createGardenSoil(e);default:}})),o()(this,"checkOnTable",(e=>{let t,i,s;return e.raised?(t=1.3125*e.soilDepth,i=e.raisedHeight,s=parseFloat(e.raisedHeight)+e.soilDepth/2):(t=1.0625*e.soilDepth,i=0,s=t/2),{soilHolderHeight:t,soilTableLegsHeight:i,soilHolderBottomOffset:1/4*e.soilDepth,soilHolderOffset:s}})),o()(this,"createInstanceEngine",(e=>{let t=this.vueObj.$refs[`elem${e}`],i=document.createElement("canvas");i.style.width="100%",i.style.height="100%",this.instances[e].canvas=i,t.append(i);let s=new BABYLON.Engine(i,!0,{preserveDrawingBuffer:!0,stencil:!0});this.instances[e].engine=s;let n=new BABYLON.Scene(s);this.instances[e].scene=n,n.clearColor=new BABYLON.Color4,this.createCamera(n,this.instances[e]),this.createMaterials(n,this.instances[e]),this.createGround(n,this.instances[e]),this.sceneController(this.instances[e]),s.runRenderLoop((function(){n.render()}))})),o()(this,"createSoil",((e,t)=>{let i=this.instances[t];this.createCamera(i.scene,i);let s=Math.abs(i.gardenPoints[0][1]-i.gardenPoints[1][1]),n=Math.abs(i.gardenPoints[0][0]-i.gardenPoints[3][0]),a=this.soilDimensions(i);s=a.length,n=a.width,i.soil&&i.soil.dispose();const o=BABYLON.MeshBuilder.CreateBox("box",{height:i.soilDepth,width:n,depth:s});let r,l=i.materials[e];return l.diffuseTexture.uScale=n/100*1.5,l.diffuseTexture.vScale=s/200*1.5,o.material=l,r=0,i.raised&&(r=parseFloat(i.raisedHeight)||0),o.position.y=i.soilDepth/2+r,i.soil=o,i.bed||(i.topofBed=r+i.soilDepth,console.log("also returned",i.topofBed)),this.createGround(i.scene,i),o})),o()(this,"destroyInstance",(e=>{let t=this.instances[e];this.state.botInstances[e]=null,t.scene.dispose(),delete this.instances[e];let i={},s=1;for(let n in this.instances)i[s++]=this.instances[n];this.instances=I()({},i),this.numInstances--,this.reCreateScenes()})),o()(this,"reCreateScenes",(()=>{for(let e in this.instances){let t=this.instances[e],i=this.vueObj.$refs[`elem${e}`],s=i.childNodes;for(let e in s)"canvas"===s[e].localName&&i.removeChild(s[e]);switch(this.createInstanceEngine(e),t.application){case"Agriculture":this.createGardenSoil(e);break}}})),o()(this,"sceneController",(e=>{let t=e.scene,i=e.initialCamRadius/100,s=e.initialCamRadius/i;e.camera.maxZ=1e8;const n=()=>{e.camera.radius-=s},a=()=>{e.camera.radius=e.initialCamRadiusDouble||e.initialCamRadius,e.camera.beta=Math.PI/4,e.camera.alpha=Math.PI/4},o=()=>{e.camera.radius+=s},r=()=>{e.camera.alpha=-Math.PI/2,e.camera.beta=0},l=()=>{e.camera.alpha=-Math.PI/2,e.camera.beta=Math.PI/2},m=()=>{e.camera.alpha=Math.PI,e.camera.beta=Math.PI/2},c=()=>{e.camera.alpha=Math.PI/2,e.camera.beta=Math.PI/2},h=()=>{e.camera.alpha=-Math.PI/2,e.camera.beta=Math.PI},d=()=>{e.camera.alpha=0,e.camera.beta=Math.PI/2};t.onKeyboardObservable.add((t=>{switch(t.type){case BABYLON.KeyboardEventTypes.KEYDOWN:switch(t.event.key){case"z":o();break;case"Z":n();break;case"T":case"t":r();break;case"C":case"c":a();break;case"D":case"d":h();break;case"L":case"l":m();break;case"R":case"r":d();break;case"F":case"f":l();break;case"B":case"b":c();break;case"H":case"h":e.bot.goHome();break;case"Backspace":e.bot.emergencyStop();break;case"ArrowUp":try{e.bot.moveForward()}catch(i){}break;case"ArrowDown":try{e.bot.moveBack()}catch(i){}break;case"ArrowLeft":try{e.bot.moveLeft()}catch(i){}break;case"ArrowRight":try{e.bot.moveRight()}catch(i){}break;case"w":case"W":try{e.bot.moveUp()}catch(i){}break;case"x":case"X":try{e.bot.moveDown()}catch(i){}break;default:console.log(t.event.key)}break;case BABYLON.KeyboardEventTypes.KEYUP:break}}));let u=new BABYLON.GamepadManager;u.onGamepadConnectedObservable.add(((t,i)=>{t instanceof BABYLON.Xbox360Pad?(t.onButtonDownObservable.add(((e,t)=>{})),t.onButtonUpObservable.add(((e,t)=>{})),t.onleftstickchanged((e=>{})),t.onrightstickchanged((e=>{}))):t instanceof BABYLON.DualShockPad?(t.onButtonDownObservable.add(((e,t)=>{})),t.onButtonUpObservable.add(((e,t)=>{})),t.onleftstickchanged((e=>{})),t.onrightstickchanged((e=>{})),t.onlefttriggerchanged((e=>{})),t.onPadDownObservable.add(((e,t)=>{})),t.onPadUpObservable.add(((e,t)=>{}))):t instanceof BABYLON.GenericPad?(t.onButtonDownObservable.add(((t,i)=>{switch(t){case 4:e.joystick.speed[2]=2;break;case 6:e.joystick.speed[3]=3;break;case 5:e.joystick.speed[4]=4;break;case 7:e.joystick.speed[5]=5;break;case 10:e.bot.goHome();break;case 11:e.bot.emergencyStop();break}})),t.onButtonUpObservable.add(((t,i)=>{switch(t){case 4:e.joystick.speed[2]=0;break;case 6:e.joystick.speed[3]=0;break;case 5:e.joystick.speed[4]=0;break;case 7:e.joystick.speed[5]=0;break}})),t.onleftstickchanged((t=>{let{x:i,y:s}=t;s=-s,e.joystick.z=s;try{e.bot.calculateMove()}catch(a){}try{clearInterval(this.zoomInterval)}catch(a){}(i<0||i>0)&&(this.zoomInterval=setInterval((()=>{i>0&&n(),i<0&&o()}),500))})),t.onrightstickchanged((t=>{let{x:i,y:s}=t;i=-i,[i,s]=[i,s].reverse(),e.joystick.x=i,e.joystick.y=s,e.bot.calculateMove()}))):t instanceof BABYLON.PoseEnabledController&&(t.onTriggerStateChangedObservable.add(((e,t)=>{})),t.onMainButtonStateChangedObservable.add(((e,t)=>{})),t.onleftstickchanged((e=>{})),t.onrightstickchanged((e=>{})))})),u.onGamepadDisconnectedObservable.add(((t,i)=>{e.joystick.x=0,e.joystick.y=0,e.joystick.z=0}))})),o()(this,"createGardenSoil",(e=>{let t=this.instances[e];if(this.unloadScene(t),!t.workSpaceLength||!t.workSpaceWidth||!t.soilDepth)return;let i=[[0,0,0],[0,t.workSpaceWidth,0],[t.workSpaceLength,t.workSpaceWidth,0],[t.workSpaceLength,0,0],[0,0,0]];t.gardenPoints=i,this.getGardenPoints(e);this.createSoil("soilMaterial",e);this.createSoilContainer(e),this.reallyShowPlants(e),t.bot.create(),console.log(this.state.botInstances),this.state.botInstances[e]=t.bot})),o()(this,"createLegs",(e=>{let t=this.instances[e];try{for(let e in t.legsMeshes)t.legsMeshes[e].dispose()}catch(m){}if(!t.raised)return;let i=this.checkOnTable(t),s=i.soilTableLegsHeight;const n=BABYLON.MeshBuilder.CreateBox("box",{height:s,width:t.legs.width,depth:t.legs.length});n.position.y=s/2;let a=this.soilDimensions(t),o=n.clone("leg2"),r=n.clone("leg3"),l=n.clone("leg4");n.position.x=-a.width/2+t.legs.width/2,n.position.z=-a.length/2+t.legs.length/2,n.material=t.materials.woodMaterial,o.position.x=a.width/2-t.legs.width/2,o.position.z=-a.length/2+t.legs.length/2,o.material=t.materials.woodMaterial,r.position.x=a.width/2-t.legs.width/2,r.position.z=a.length/2-t.legs.length/2,r.material=t.materials.woodMaterial,l.position.x=-a.width/2+t.legs.width/2,l.position.z=a.length/2-t.legs.length/2,l.material=t.materials.woodMaterial,t.legsMeshes={leg1:n,leg2:o,leg3:r,leg4:l}})),o()(this,"getGardenPoints",(e=>{let t=this.instances[e];t.gardenPoints[0][1]=-t.gardenPoints[1][1]/2,t.gardenPoints[1][1]=Math.abs(t.gardenPoints[0][1]),t.gardenPoints[3][1]=-t.gardenPoints[2][1]/2,t.gardenPoints[2][1]=Math.abs(t.gardenPoints[3][1]),t.gardenPoints[0][0]=-t.gardenPoints[3][0]/2,t.gardenPoints[3][0]=Math.abs(t.gardenPoints[0][0]),t.gardenPoints[1][0]=-t.gardenPoints[2][0]/2,t.gardenPoints[2][0]=Math.abs(t.gardenPoints[1][0])})),o()(this,"createGround",((e,t)=>{try{t.ground.dispose}catch(a){}let i=new Y("mix",e);i.mixTexture1=new BABYLON.Texture("textures/mixMap.png",e),i.diffuseTexture1=new BABYLON.Texture("textures/grass.jpg",e),i.diffuseTexture2=new BABYLON.Texture("textures/rock.png",e),i.diffuseTexture3=new BABYLON.Texture("textures/farm.jpeg",e),i.diffuseTexture4=new BABYLON.Texture("textures/grass.jpg",e),i.diffuseTexture1.uScale=i.diffuseTexture1.vScale=10,i.diffuseTexture2.uScale=i.diffuseTexture2.vScale=10,i.diffuseTexture3.uScale=i.diffuseTexture3.vScale=20,i.diffuseTexture4.uScale=i.diffuseTexture4.vScale=10,i.mixTexture2=new BABYLON.Texture("textures/mixMap_2.png",e),i.diffuseTexture5=new BABYLON.Texture("textures/soilTexture.jpeg",e),i.diffuseTexture6=new BABYLON.Texture("textures/soilTexture.jpeg",e),i.diffuseTexture7=new BABYLON.Texture("textures/sand.jpg",e),i.diffuseTexture8=new BABYLON.Texture("textures/grass.jpg",e),i.diffuseTexture5.uScale=i.diffuseTexture5.vScale=10,i.diffuseTexture6.uScale=i.diffuseTexture6.vScale=10,i.diffuseTexture7.uScale=i.diffuseTexture7.vScale=5,i.diffuseTexture8.uScale=i.diffuseTexture8.vScale=10;let{length:s}=this.soilDimensions(t),n=BABYLON.Mesh.CreateGroundFromHeightMap("ground","textures/heightMap.png",2*s||12e3,2*s||12e3,100,0,10,e,!1);n.position.y=-2.05,n.position.y=0,n.material=i,n.receiveShadows=!0,n.checkCollisions=!0,t.ground=n})),o()(this,"createMaterials",((e,t)=>{let i=new BABYLON.StandardMaterial("",e);i.diffuseTexture=new BABYLON.Texture("/images/grass.jpeg",e),t.materials={},t.materials.grassMaterial=i;let s=new BABYLON.StandardMaterial("",e);s.diffuseTexture=new BABYLON.Texture("/images/FarmBotLogo.png",e),t.materials.farmBotMaterial=s;let n=new BABYLON.StandardMaterial("",e);n.diffuseTexture=new BABYLON.Texture("/images/sand.jpg",e),t.materials.sandMaterial=n;let a=new BABYLON.StandardMaterial("",e);a.diffuseTexture=new BABYLON.Texture("/anim/2d.svg",e),a.diffuseTexture.hasAlpha=!0,a.backFaceCulling=!1,t.materials.farmMaterial=a;let o=new BABYLON.StandardMaterial("",e);o.diffuseTexture=new BABYLON.Texture("/images/albedo.png.jpg",e),t.materials.woodMaterial=o;let r=new BABYLON.StandardMaterial("",e);r.diffuseTexture=new BABYLON.Texture("/textures/v-slot-side.png",e),t.materials.vSlotSideMaterial=r;let l=new BABYLON.StandardMaterial("",e);l.diffuseTexture=new BABYLON.Texture("/textures/v-slot-side-Up.png",e),t.materials.vSlotSideUpMaterial=l;let m=new BABYLON.StandardMaterial("",e);m.diffuseTexture=new BABYLON.Texture("/textures/blackTexture.png",e),t.materials.blackMaterial=m;let c=new BABYLON.StandardMaterial("",e);c.diffuseTexture=new BABYLON.Texture("/textures/grayTexture.png",e),t.materials.grayMaterial=c;let h=new BABYLON.StandardMaterial("",e);h.diffuseTexture=new BABYLON.Texture("/textures/speckledPlasticTexture.jpeg",e),t.materials.electricalBoxMaterial=h;let d=new BABYLON.StandardMaterial("",e);d.diffuseTexture=new BABYLON.Texture("/textures/farmBotLogo.png",e),d.diffuseTexture.hasAlpha=!0,t.materials.logoMaterial=d;let u=new BABYLON.StandardMaterial("",e);u.diffuseTexture=new BABYLON.Texture("/anim/2d.svg",e),t.materials.drySoilMaterial=u;let p=new BABYLON.StandardMaterial("texturePlane",e);p.diffuseTexture=new BABYLON.Texture("textures/farm.jpeg",e),p.diffuseTexture.uScale=20,p.diffuseTexture.vScale=30,p.backFaceCulling=!1,t.materials.groundMaterial=p;let b=new BABYLON.StandardMaterial("texturePlane",e);b.diffuseTexture=new BABYLON.Texture("textures/farm.jpeg",e),b.diffuseTexture.uScale=2,b.diffuseTexture.vScale=3,b.backFaceCulling=!1,t.materials.groundMaterial1=b;let g=new BABYLON.StandardMaterial("",e);g.diffuseTexture=new BABYLON.Texture("/textures/soilTexture.jpeg",e),g.specularColor=BABYLON.Color3.Black(),t.materials.soilMaterial=g;let _=new BABYLON.StandardMaterial("",e);_.diffuseTexture=new BABYLON.Texture("/textures/aluminiumTexture.jpeg",e),t.materials.aluminiumMaterial=_})),o()(this,"createCamera",((e,t)=>{try{t.camera.dispose(),t.light.dispose(),t.light1.dispose(),t.light2.dispose()}catch(g){console.log(g)}let i=t.initialCamRadius;if(t.gardenPoints){let{length:e}=this.soilDimensions(t);i=e,t.initialCamRadiusDouble=i*=2,t.initialCamRadiusDouble=i}let s=new BABYLON.ArcRotateCamera("Camera",-Math.PI/2,Math.PI/3,i,new BABYLON.Vector3(0,0,10),e);function n(e,t,s){t.inertia=.9,t.lowerRadiusLimit=10,t.upperRadiusLimit=3*i,t.upperBetaLimit=Math.PI-.1,t.angularSensibilityX=t.angularSensibilityY=500,a(e,t);const n=BABYLON.Vector3.Zero(),o=()=>{0===n.x&&0===n.y&&0===n.z||(t.target.addInPlace(n),n.scaleInPlace(t.inertia),h(n))},c=()=>{t.wheelPrecision=1/t.radius*1e3},d=(i,s)=>{const a=r(i,s,t);l(a,e,t,n)},u=BABYLON.Vector2.Zero(),p=()=>{m(e,t,u)},b=()=>{a(e,t),e.onPointerObservable.removeCallback(p)};e.onPointerObservable.add(((i,s)=>{b(),0===i.event.button&&(a(e,t),u.copyFromFloats(e.pointerX,e.pointerY),e.onPointerObservable.add(p,BABYLON.PointerEventTypes.POINTERMOVE))}),BABYLON.PointerEventTypes.POINTERDOWN),e.onPointerObservable.add(((e,t)=>{b()}),BABYLON.PointerEventTypes.POINTERUP),e.onPointerObservable.add(d,BABYLON.PointerEventTypes.POINTERWHEEL),e.onBeforeRenderObservable.add(o),e.onBeforeRenderObservable.add(c),e.getEngine().getRenderingCanvas().addEventListener("contextmenu",(e=>{e.preventDefault()}))}function a(e,t){t.targetBox;var i=t.target.subtract(t.position);t.hitplane=BABYLON.Plane.FromPositionAndNormal(BABYLON.Vector3.Zero(),i);i=t.target.subtract(t.position);var s=t.position.projectOnPlane(t.hitplane,t.target);t.target=s;var n=0+t.inertialAlphaOffset+t.inertialBetaOffset+t.inertialRadiusOffset;n&&window.setTimeout((()=>{a(e,t)}))}function o(e,t){var i=t.target.subtract(t.position);i.normalize();var s=e.createPickingRay(e.pointerX,e.pointerY,BABYLON.Matrix.Identity(),t,!1);const n=s.intersectsPlane(t.hitplane);return s.origin.addInPlace(s.direction.scaleInPlace(n))}function r(e,t,i){const s=e.event;s.preventDefault();let n=0;n=s.wheelDelta?s.wheelDelta:60*-(s.deltaY||s.detail);var a=n/(10*i.wheelPrecision);return a}function l(e,i,s,n){if(s.radius-s.lowerRadiusLimit<1&&e>0)return;if(s.upperRadiusLimit-s.radius<1&&e<0)return;const a=1-s.inertia;s.radius-(s.inertialRadiusOffset+e)/a<s.lowerRadiusLimit?e=(s.radius-s.lowerRadiusLimit)*a-s.inertialRadiusOffset:s.radius-(s.inertialRadiusOffset+e)/a>s.upperRadiusLimit&&(e=(s.radius-s.upperRadiusLimit)*a-s.inertialRadiusOffset);const r=e/a,l=r/s.radius,m=o(i,s),c=m.subtract(s.target),h=c.scale(l);h.scaleInPlace(a),n.addInPlace(h),s.inertialRadiusOffset+=e,t.inertialRadiusOffset=s.inertialRadiusOffset}function m(e,t,i){const s=e.pointerX-i.x,n=e.pointerY-i.y;i.copyFromFloats(e.pointerX,e.pointerY),c(s,n,t)}function c(e,i,s){const n=e/s.angularSensibilityX,a=i/s.angularSensibilityY;t.cameraOpts={alphaOffsetDelta:n,betaOffsetDelta:a},s.inertialAlphaOffset-=n,s.inertialBetaOffset-=a,t.cameraOpts.alphaOffsetDelta=s.inertialAlphaOffset,t.cameraOpts.betaOffsetDelta=s.inertialBetaOffset}function h(e){Math.abs(e.x)<BABYLON.Epsilon&&(e.x=0),Math.abs(e.y)<BABYLON.Epsilon&&(e.y=0),Math.abs(e.z)<BABYLON.Epsilon&&(e.z=0)}n(e,s,!1);let d=new BABYLON.PointLight("pointLight",new BABYLON.Vector3(1,i,1),e);d.range=i;let u=new BABYLON.HemisphericLight("hemiLight",new BABYLON.Vector3(0,i,0),e),p=new BABYLON.HemisphericLight("hemiLight",new BABYLON.Vector3(0,-10,0),e),b=e=>e/360*(2*Math.PI);s.lowerBetaLimit=-Math.PI/2+b(1),s.upperBetaLimit=Math.PI/2-b(1),s.maxZ=2*i,t.light=d,t.light1=u,t.light2=p,t.camera=s})),o()(this,"createSoilBed",(()=>{this.getGardenPoints();this.scene,this.createSoil("soilMaterial");this.createLegs(),this.createSoilContainer(),this.createPlants()})),o()(this,"showAxis",((e,t)=>{let i=this.instances[e].scene,s=function(e,t,s){let n=new BABYLON.DynamicTexture("DynamicTexture",50,i,!0);n.hasAlpha=!0,n.drawText(e,5,40,"bold 36px Arial",t,"transparent",!0);let a=new BABYLON.Mesh.CreatePlane("TextPlane",s,i,!0);return a.material=new BABYLON.StandardMaterial("TextPlaneMaterial",i),a.material.backFaceCulling=!1,a.material.specularColor=new BABYLON.Color3(0,0,0),a.material.diffuseTexture=n,a},n=BABYLON.Mesh.CreateLines("axisX",[new BABYLON.Vector3.Zero,new BABYLON.Vector3(t,0,0),new BABYLON.Vector3(.95*t,.05*t,0),new BABYLON.Vector3(t,0,0),new BABYLON.Vector3(.95*t,-.05*t,0)],i);n.color=new BABYLON.Color3(1,0,0);let a=s("X","red",t/10);a.position=new BABYLON.Vector3(.9*t,-.05*t,0);let o=BABYLON.Mesh.CreateLines("axisY",[new BABYLON.Vector3.Zero,new BABYLON.Vector3(0,t,0),new BABYLON.Vector3(-.05*t,.95*t,0),new BABYLON.Vector3(0,t,0),new BABYLON.Vector3(.05*t,.95*t,0)],i);o.color=new BABYLON.Color3(0,1,0);let r=s("Y","green",t/10);r.position=new BABYLON.Vector3(0,.9*t,-.05*t);let l=BABYLON.Mesh.CreateLines("axisZ",[new BABYLON.Vector3.Zero,new BABYLON.Vector3(0,0,t),new BABYLON.Vector3(0,-.05*t,.95*t),new BABYLON.Vector3(0,0,t),new BABYLON.Vector3(0,.05*t,.95*t)],i);l.color=new BABYLON.Color3(0,0,1);let m=s("Z","blue",t/10);m.position=new BABYLON.Vector3(0,.05*t,.9*t)})),o()(this,"addOrRemoveBed",(e=>{let t=this.instances[e];t.raised=!1,this.createGardenSoil(e)})),o()(this,"deleteInstance",(()=>{})),o()(this,"getBots",(()=>{})),o()(this,"setBot",(()=>{})),o()(this,"showPlants",((e,t)=>{let i=this.instances[t];i.plantPoints=e,i.showPlants=!0,this.reallyShowPlants(t)})),o()(this,"hidePlants",(e=>{let t=this.instances[e];if(t.plantMeshes)for(let i in t.self.plantMeshes)t.plantMeshes[i].dispose;t.showPlants=!1})),o()(this,"reallyShowPlants",(e=>{let t=this.instances[e];if(!t.showPlants)return;if(t.plantMeshes)for(let o in t.plantMeshes)t.plantMeshes[o].dispose();let i=t.scene,s=[],n=[],a=t.plantPoints||[];Object.values(a).map((e=>{"Plant"==e["pointer_type"]&&s.push({name:e.name,x:e.y,y:e.x}),"Weed"==e["pointer_type"]&&n.push({name:e.name,x:e.y,y:e.x})})),t.plantMeshes=[],BABYLON.SceneLoader.Append("stl/","corn.obj",i,(e=>{e.createDefaultCameraOrLight(!0,!0,!0),e.activeCamera.alpha+=Math.PI;let i=e.meshes.slice(-1)[0];t.plantMeshes.push(i),i.createNormals(!1);let n=s.filter((e=>"Corn"===e.name));for(let s in n){let e=n[s],o=i.clone(`Corn${s}`);o.scaling.x=3,o.scaling.y=3,o.scaling.z=3,o.position.y=t.topofBed;let r=0,l=0;try{r=t.bot.bot.limitPositions.y.min,l=t.bot.bot.limitPositions.x.min}catch(a){}r!==1/0&&r!=-1/0||(r=0),l!==1/0&&l!=-1/0||(l=0),o.position.x=r+e.y,o.position.z=l+e.x,o.rotation.x=-Math.PI/2,t.plantMeshes.push(o)}i.setEnabled(!1)}))})),this.state=T}destroyInitHandler(){}initInstance(e,t){this.vueObj=e,this.hadstarted||(window.onload=this.initHandler)}createInstance(){this.numInstances++,setTimeout((()=>{let e=this.numInstances;this.instances[this.numInstances]={application:null,showPlants:!1,bed:!1,raised:!0,raisedHeight:750,plantHeight:500,workSpaceLength:6e3,workSpaceWidth:2400,botLength:3e3,botWidth:1e3,soilDepth:100,plankThickness:18,legs:{width:100,length:100},initialCamRadius:400,botType:null,botTypeType:null,enableExternalControls:!1,joystick:{x:0,y:0,z:0,speed:{}},topofBed:0,reallyShowPlants:()=>{this.reallyShowPlants(e)}},this.instances[this.numInstances].bot=new z(this.instances[this.numInstances],this),this.createInstanceEngine(this.numInstances)}),100)}createSoilContainer(e){let t=this.instances[e];try{for(let e in t.planks)t.planks[e].dispose()}catch(h){}if(this.createLegs(e),!t.bed)return!1;let i=this.checkOnTable(t),s=this.soilDimensions(t),n=(i.soilTableLegsHeight,i.soilHolderHeight),a=i.soilHolderOffset,o=2*t.plankThickness+s.width;const r=BABYLON.MeshBuilder.CreateBox("box",{height:n,width:o,depth:t.plankThickness});t.topofBed=a+n/2,console.log("RETURNED....",t.topofBed),r.position.y=a;const l=r.clone("plank3");r.material=t.materials.woodMaterial,r.position.z=-t.plankThickness/2-s.length/2,l.position.z=t.plankThickness/2+s.length/2,l.material=t.materials.woodMaterial,o=s.length;const m=BABYLON.MeshBuilder.CreateBox("box",{height:n,width:o,depth:t.plankThickness});m.rotation.y=Math.PI/2,m.position.y=a,m.material=t.materials.vSlotSideMaterial;const c=m.clone("plank4");m.position.x=t.plankThickness/2+s.width/2,c.position.x=-t.plankThickness/2-s.width/2,c.material=t.materials.vSlotSideMaterial,t.planks={plank1:r,plank2:m,plank3:l,plank4:c}}soilDimensions(e){try{let t=Math.abs(e.gardenPoints[0][1]-e.gardenPoints[1][1]),i=Math.abs(e.gardenPoints[0][0]-e.gardenPoints[3][0]);return{length:i,width:t}}catch(t){return{length:!1,width:!1}}}initializeBot(){let{length:e,width:t,height:i,botType:s}=options}}const C=new D},"60a8":function(e){e.exports=JSON.parse('{"FarmBot":{"Genesis":{"Length":3000,"Width":1500,"Plant Height":500},"Genesis XL":{"Length":6000,"Width":3000,"Plant Height":500},"Express":{"Length":3000,"Width":1200,"Plant Height":500},"Express XL":{"Length":6000,"Width":2400,"Plant Height":500}},"AngelBot":{"Ground Cable":[],"Aerial Cable":[],"Ground Rail":[],"Aerial Rail":[]}}')},"634c":function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",{ref:"botsElement",staticClass:"padding bg-grey-1 full-height noOverflow"},[i("q-splitter",{staticClass:"absolute full-width",staticStyle:{height:"100%"},attrs:{horizontal:"",limits:[0,1/0],"before-class":"noOverflow","after-class":"noOverflow"},scopedSlots:e._u([{key:"before",fn:function(){return[i("div",{staticClass:"q-pa-none full-height full-width"},[i("q-splitter",{staticClass:"absolute full-width",staticStyle:{height:"100%"},attrs:{limits:[0,1/0],"before-class":"noOverflow","after-class":"noOverflow"},scopedSlots:e._u([{key:"before",fn:function(){return[i("div",{ref:"elem1",staticClass:"q-pa-none full-height full-width"},[i("instanceEditBtn",{attrs:{angelBot:e.angelBot,instanceNumber:1,parent:e.parent}})],1)]},proxy:!0},{key:"after",fn:function(){return[i("div",{ref:"elem2",staticClass:"q-pa-none full-height full-width"},[i("instanceEditBtn",{attrs:{angelBot:e.angelBot,instanceNumber:2,parent:e.parent}})],1)]},proxy:!0}]),model:{value:e.splitterModel[1],callback:function(t){e.$set(e.splitterModel,1,t)},expression:"splitterModel[1]"}})],1)]},proxy:!0},{key:"after",fn:function(){return[e.splitterModel[0]<100?i("div",{staticClass:"q-pa-none"},[i("q-splitter",{staticClass:"absolute full-width",staticStyle:{height:"100%"},attrs:{limits:[0,1/0],"before-class":"noOverflow","after-class":"noOverflow"},scopedSlots:e._u([{key:"before",fn:function(){return[i("div",{ref:"elem3",staticClass:"q-pa-none full-height full-width"},[i("instanceEditBtn",{attrs:{angelBot:e.angelBot,instanceNumber:3,parent:e.parent}})],1)]},proxy:!0},{key:"after",fn:function(){return[i("div",{ref:"elem4",staticClass:"q-pa-none full-height full-width"},[i("instanceEditBtn",{attrs:{angelBot:e.angelBot,instanceNumber:4,parent:e.parent}})],1)]},proxy:!0}],null,!1,1500052052),model:{value:e.splitterModel[2],callback:function(t){e.$set(e.splitterModel,2,t)},expression:"splitterModel[2]"}})],1):e._e()]},proxy:!0}]),model:{value:e.splitterModel[0],callback:function(t){e.$set(e.splitterModel,0,t)},expression:"splitterModel[0]"}}),i("q-page-sticky",{attrs:{position:"bottom-right",offset:[18,18]}},[i("q-btn",{attrs:{fab:"",icon:"add",color:"primary",disable:e.disableMoreScreens},on:{click:function(t){return e.angelBot.createInstance()}}})],1),e.sideBarOpen?i("simulatorSideBar",{attrs:{angelBot:e.angelBot,stateController:e.angelBot.state,parent:e.parent,instanceNumber:e.selectedInstance}}):e._e()],1)},n=[],a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"absolute-bottom"},[i("q-btn",{attrs:{round:"",size:"sm",icon:"settings",color:"primary"},on:{click:e.openSideBar}})],1)])},o=[],r=i("5d57"),l={name:"instanceEditBtn",components:{},props:["angelBot","instanceNumber","parent"],data(){return{}},async created(){},methods:{openSideBar(){this.parent.openSideBar(this.instanceNumber)}},computed:{},watch:{}},m=l,c=i("2877"),h=i("9c40"),d=i("eebe"),u=i.n(d),p=Object(c["a"])(m,a,o,!1,null,null,null),b=p.exports;u()(p,"components",{QBtn:h["a"]});var g=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-drawer",{staticClass:"bg-primary",staticStyle:{"overflow-y":"scroll"},attrs:{bordered:"",side:"right",width:e.rightSideBarSize,overlay:"",breakpoint:2,behavior:"desktop"},model:{value:e.rightSidebarOpen,callback:function(t){e.rightSidebarOpen=t},expression:"rightSidebarOpen"}},[i("q-toolbar",{staticClass:"bg-primary text-white",staticStyle:{height:"10%"}},[i("q-toolbar-title",{staticClass:"q-mt-md q-ml-md"},[i("span",{staticClass:"text-weight-bold q-pt-lg"},[e._v("Angel Robotics Simulator")]),i("br"),i("span",{staticClass:"text-caption",staticStyle:{"font-size":"0.8em"}},[e._v("Instance Settings")])]),i("q-btn",{attrs:{dense:"",icon:"delete",color:"red",label:"Destroy Instance"},on:{click:function(t){e.angelBot.destroyInstance(e.instanceNumber),e.closeSelf()}}}),i("q-btn",{attrs:{flat:"",round:"",dense:"",icon:"close"},on:{click:e.closeSelf}})],1),i("q-splitter",{staticClass:"absolute full-width bg-grey-1",staticStyle:{height:"90%"},attrs:{limits:[0,1/0]},scopedSlots:e._u([{key:"before",fn:function(){return[i("div",{staticClass:"q-pa-sm"},[i("q-expansion-item",{attrs:{"expand-icon-toggle":"","expand-separator":"",label:"Application",caption:"The area where the robot is to be employed"},on:{show:function(t){return e.showText("application")}}},[i("div",{staticClass:"q-pa-md"},[i("q-select",{attrs:{filled:"",label:"Application",options:Object.keys(e.angelBot.applications())},on:{input:e.updateApplication},model:{value:e.angelBot.instances[e.instanceNumber].application,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"application",t)},expression:"angelBot.instances[instanceNumber].application"}}),"Agriculture"===e.angelBot.instances[e.instanceNumber].application?i("div",[i("q-input",{attrs:{type:"number",label:"Garden Length(mm)"},on:{input:function(t){return e.angelBot.createGardenSoil(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].workSpaceLength,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"workSpaceLength",t)},expression:"angelBot.instances[instanceNumber].workSpaceLength"}}),i("q-input",{attrs:{type:"number",label:"Garden Width(mm)"},on:{input:function(t){return e.angelBot.createGardenSoil(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].workSpaceWidth,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"workSpaceWidth",t)},expression:"angelBot.instances[instanceNumber].workSpaceWidth"}}),i("q-input",{attrs:{type:"number",label:"Soil Depth(mm)"},on:{input:function(t){return e.angelBot.createGardenSoil(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].soilDepth,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"soilDepth",t)},expression:"angelBot.instances[instanceNumber].soilDepth"}}),i("q-input",{attrs:{type:"number",label:"Plant Height(mm)"},on:{input:function(t){return e.angelBot.createGardenSoil(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].plantHeight,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"plantHeight",t)},expression:"angelBot.instances[instanceNumber].plantHeight"}}),i("q-checkbox",{attrs:{label:"Has Bed"},on:{input:function(t){return e.angelBot.addOrRemoveBed(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].bed,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"bed",t)},expression:"angelBot.instances[instanceNumber].bed"}}),e.angelBot.instances[e.instanceNumber].bed?i("div",[i("q-checkbox",{attrs:{label:"Raised Bed?"},on:{input:function(t){return e.angelBot.createGardenSoil(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].raised,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"raised",t)},expression:"angelBot.instances[instanceNumber].raised"}}),e.angelBot.instances[e.instanceNumber].raised?i("q-input",{attrs:{type:"number",label:"Bed Height(mm)"},on:{input:function(t){return e.angelBot.createGardenSoil(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].raisedHeight,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"raisedHeight",t)},expression:"angelBot.instances[instanceNumber].raisedHeight"}}):e._e()],1):e._e(),i("q-checkbox",{attrs:{label:"Show plants"},on:{input:e.startShowingPlants},model:{value:e.showPlants,callback:function(t){e.showPlants=t},expression:"showPlants"}})],1):e._e()],1)]),i("q-expansion-item",{attrs:{"expand-icon-toggle":"","expand-separator":"",label:"Bot Type",caption:"The Type of Robot"},on:{show:function(t){return e.showText("botType")}}},[i("div",{staticClass:"q-pa-md"},[i("q-select",{attrs:{filled:"",options:Object.keys(e.angelBot.botTypes()),label:"Bot Type"},on:{input:e.updateBotType},model:{value:e.angelBot.instances[e.instanceNumber].botType,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"botType",t)},expression:"angelBot.instances[instanceNumber].botType"}}),e.angelBot.instances[e.instanceNumber].botType?i("q-select",{attrs:{filled:"",options:Object.keys(e.angelBot.botTypes()[e.angelBot.instances[e.instanceNumber].botType]),label:"Bot Model"},on:{input:function(t){return e.angelBot.changeBotType(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].botTypeType,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"botTypeType",t)},expression:"angelBot.instances[instanceNumber].botTypeType"}}):e._e(),"FarmBot"!==e.angelBot.instances[e.instanceNumber].botType?i("q-input",{attrs:{type:"number",label:"Bot Length(mm)"},on:{input:function(t){return e.angelBot.createGardenSoil(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].botLength,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"botLength",t)},expression:"angelBot.instances[instanceNumber].botLength"}}):e._e(),"FarmBot"!==e.angelBot.instances[e.instanceNumber].botType?i("q-input",{attrs:{type:"number",label:"Bot Width(mm)"},on:{input:function(t){return e.angelBot.createGardenSoil(e.instanceNumber)}},model:{value:e.angelBot.instances[e.instanceNumber].botWidth,callback:function(t){e.$set(e.angelBot.instances[e.instanceNumber],"botWidth",t)},expression:"angelBot.instances[instanceNumber].botWidth"}}):e._e()],1)]),i("q-expansion-item",{attrs:{"expand-icon-toggle":"","expand-separator":"",label:"WebApp",caption:"Log in to Web App to Control your robot from there."}},[i("div",{staticClass:"q-pa-md"},[i("q-form",{staticClass:"text-white",on:{submit:e.onSubmit,reset:e.onReset}},[i("q-input",{attrs:{label:"Email",rules:[function(e){return e&&e.length>0||"Please enter your email address"},function(t){return e.isValidEmail()||"Invalid email address"}]},model:{value:e.email,callback:function(t){e.email=t},expression:"email"}}),i("q-input",{attrs:{label:"Password",type:"password",rules:[function(e){return null!==e&&""!==e||"Please enter your password"}],"error-message":e.passwordErrorMessage},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),i("div",{staticClass:"q-pa-md"},[i("q-btn",{attrs:{label:"Submit",type:"submit",color:"primary"}}),i("q-btn",{staticClass:"q-ml-sm",attrs:{label:"Reset",type:"reset",color:"white",flat:""}})],1)],1)],1)])],1)]},proxy:!0},{key:"after",fn:function(){return[i("div",{staticClass:"q-pa-md"},[i("texts",{attrs:{selectedSectionText:e.selectedSectionText}})],1)]},proxy:!0}]),model:{value:e.splitterModel,callback:function(t){e.splitterModel=t},expression:"splitterModel"}}),i("div")],1)},_=[],y=(i("ddb0"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("q-tabs",{model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[i("q-tab",{attrs:{name:"info",label:"Info"}}),i("q-tab",{attrs:{name:"controls",label:"Controls"}})],1),i("q-tab-panels",{staticClass:"bg-grey-1 q-ma-none full-width q-pa-none",attrs:{animated:""},model:{value:e.tab,callback:function(t){e.tab=t},expression:"tab"}},[i("q-tab-panel",{attrs:{name:"controls"}},[i("q-markdown",[e._v("\n### Controls\n\n|Key|Function|\n|---|--------|\n|z| Zoom Out|\n|Z| Zoom In|\n|C \\(c\\)| Zoom to Center|\n|T (t)| Top View|\n|D (d)| Bottom View|\n|L (l)| Left View|\n|R \\(r\\)| Right View|\n|F (f)| Front View|\n|H (g)| Go Home|\n|Backspace| Emergency Stop|\n|Mouse | Rotate|\n|Mouse Wheel | Zoom|\n\n### Gamepad Controls\n|Key|Function|\n|---|--------|\n|Left Stick x| Zoom|\n|Left Stick y| Z-Axis|\n|Right Stick x| X-Axis|\n|Right Stick y| Y-Axis|\n|Left Stick btn| Go Home|\n|Right Stick btn| Emergency Stop|\n|Buttons(4-7) | Speed |\n\n")])],1),i("q-tab-panel",{attrs:{name:"info"}},["Init"===e.selectedSectionText?i("div",[i("p",{staticClass:"text-subtitle1"},[e._v("Use these settings to set up your simulation. ")]),i("p",[e._v("We have only two types of robots from which you will be able to select. But they can work in a wide range of fields: ")]),i("p",[e._v("1: Farmbot from Farmbot Inc")]),i("p",[e._v("2: Our own AngelBot - the master of cables, rails and prices.")]),i("p",[e._v("AngelBot is so simple you can fabricate it yourself, and so cheap you can afford an army of them. It is designed to be affordable.")]),i("p",{staticClass:"text-subtitle1 underline"},[e._v("You can use this simulator to:")]),i("p",[e._v("1. Test how either of the robots works in any field that is relevant to it.")]),i("p",[e._v("2. Test control code (or sequences) before deploying to the real robot. The advantages of this are manifold.")]),i("p",[e._v("3. Test control code even if you do not have a physical robot.")]),i("p",[e._v("4. Teach programming. This simulator will provide a means of letting the children see the result of the code the develop (to control the robots)")]),i("p",[e._v("5. Control the robot without the webApp")]),i("p",[e._v("6. Compare different features of these two robots")]),i("p",[e._v("6. Compare different features of these two robots")])]):"application"===e.selectedSectionText?i("div",[i("p",[e._v("Select the area in which you'd like to use the robot.")]),i("p",[e._v("The list provides but a simple subset of the areas in which the robots can be used. How else can they be used? - This is left to the imagination of the creative mind.")]),i("p",[e._v("We will keep addition more applications to the list as soon as they have been implemented")])]):"botType"===e.selectedSectionText?i("div",{staticClass:"q-ma-none"},[i("p",[e._v("Select the type of Robot which you'd like to simulate.")]),i("q-expansion-item",{attrs:{"expand-icon-toggle":"","expand-separator":"",label:"Farmbot"}},[i("q-markdown",[e._v("\n### Genesis (Regular)\n|||\n|--|---|\n|Length |3000mm|\n|Width|1500mm|\n|Height|500mm|\n\n### Genesis xl\n|||\n|--|---|\n|Length |6000mm|\n|Width|3000mm|\n|Height|500mm|\n\n### Express (Regular)\n|||\n|--|---|\n|Length |3000mm|\n|Width|1200mm|\n|Height|500mm|\n\n### Express xl\n|||\n|--|---|\n|Length |6000mm|\n|Width|2400mm|\n|Height|500mm|\n\n")])],1),i("q-expansion-item",{attrs:{"expand-icon-toggle":"","expand-separator":"",label:"AngelBot"}},[i("q-markdown",[e._v("\n1. Ground Cable\nGuided by a cable, but supported by the ground.\n2. Aerial Cable \nGuided by a cable, and supported by the same cable.\n3. Ground Rail \nGuided by a rail on the ground.\n4. Aerial Rail\nGuided by a suspended rail.\n          ")])],1)],1):i("p")])],1)],1)}),f=[],x={name:"texts",props:["selectedSectionText"],created(){},components:{},data(){return{tab:"info"}},methods:{},computed:{}},v=x,w=(i("e89a"),i("429bb")),B=i("7460"),k=i("adad"),S=i("823b"),O=i("3b73"),M=Object(c["a"])(v,y,f,!1,null,null,null),T=M.exports;u()(M,"components",{QTabs:w["a"],QTab:B["a"],QTabPanels:k["a"],QTabPanel:S["a"],QExpansionItem:O["a"]});var L=i("1712"),P=i("cf57"),A={name:"simulatorSideBar",props:["angelBot","instanceNumber","parent","stateController"],async created(){let[e,t]=await Object(L["to"])(r["auth"].checkTokenAndRefresh());if(e)return this.showPlants=!1,this.$q.notify({type:"You need to log in to farmbot cloud first",message:e});this.init()},components:{texts:T},data(){return{showPlants:!1,rightSidebarOpen:!0,password:"test@cseco.co.ke",email:"test@cseco.co.ke",botType:null,botTypeType:null,selectedApplication:null,splitterModel:50,selectedSectionText:"Init",passwordErrorMessage:""}},methods:{isValidEmail(){const e=/^(?=[a-zA-Z0-9@._%+-]{6,254}$)[a-zA-Z0-9._%+-]{1,64}@(?:[a-zA-Z0-9-]{1,63}\.){1,8}[a-zA-Z]{2,63}$/;return e.test(this.email)||"Invalid email"},async startShowingPlants(){this.showPlants&&this.reallyShowPlants()},async init(){this.stateController.startOrRestartSimulator();await this.stateController.farmbotGET("plantTemplates");this.showPlants&&this.reallyShowPlants(!0)},async reallyShowPlants(e){if(!e){let[e,t]=await Object(L["to"])(r["auth"].checkTokenAndRefresh());if(e)return this.showPlants=!1,this.$q.notify({type:"You need to log in to farmbot cloud first",message:e})}let t=await this.stateController.farmbotGET("points");this.angelBot.showPlants(t,this.instanceNumber)},showCustom(e=""){const t=this.$q.dialog({title:e,message:"",progress:{spinner:P["a"],color:"primary"},persistent:!0,ok:!1}),i=setInterval((()=>{!1===this.working&&(clearInterval(i),t.hide())}),500)},async onSubmit(){let e={email:this.email,password:this.password};this.working=!0,this.showCustom();let[t,i]=await Object(L["to"])(r["auth"].logIn(e));if(this.working=!1,t)return this.$q.notify({type:"negative",message:t}),this.password="",void(this.passwordErrorMessage=t||t.error||t.message||"wrong email/password");this.$q.notify({type:"positive",message:"Successful login to farmbot cloud."}),this.init()},onReset(){this.email=null,this.password=null},closeSelf(){this.parent.closeSideBar()},updateApplication(e){this.$set(this.angelBot.instances[this.instanceNumber],"application",e);let t=[];t[this.instanceNumber]=this.angelBot.instances[this.instanceNumber],this.angelBot.instances=Object.assign({},this.angelBot.instances,t)},updateBotType(e){this.$set(this.angelBot.instances[this.instanceNumber],"botType",e);let t=[];t[this.instanceNumber]=this.angelBot.instances[this.instanceNumber],this.angelBot.instances=Object.assign({},this.angelBot.instances,t)},showText(e){this.selectedSectionText=e}},computed:{rightSideBarSize(){return this.$q.screen.lt.xs||this.$q.screen.lt.sm||this.$q.screen.lt.md?document.getElementsByTagName("body")[0].clientWidth:.75*document.getElementsByTagName("body")[0].clientWidth}}},N=A,I=i("9404"),Y=i("65c6"),z=i("6ac5"),D=i("8562"),C=i("ddd8"),E=i("27f9"),q=i("8f8e"),R=i("0378"),F=Object(c["a"])(N,g,_,!1,null,null,null),G=F.exports;u()(F,"components",{QDrawer:I["a"],QToolbar:Y["a"],QToolbarTitle:z["a"],QBtn:h["a"],QSplitter:D["a"],QExpansionItem:O["a"],QSelect:C["a"],QInput:E["a"],QCheckbox:q["a"],QForm:R["a"]});const V=i("5d57"),{angelBot:$}=V;var j={name:"demos",components:{instanceEditBtn:b,simulatorSideBar:G},data(){return{parent:this,sideBarOpen:!1,instanceNumber:0,selectedInstance:0,angelBot:$,splitterModel:[100,100,100]}},async created(){console.log("angelBot"),console.log($),$.initInstance(this,"botsElement"),this.angelBot.createInstance()},methods:{openSideBar(e){this.selectedInstance=e,this.sideBarOpen=!1,this.$nextTick((()=>this.sideBarOpen=!0))},closeSideBar(){this.sideBarOpen=!1}},computed:{disableMoreScreens(){return $.numInstances>=4}},watch:{splitterModel:{handler(e){if($.numInstances<2){if(this.splitterModel.toString()===[100,100,100].toString())return;setTimeout((()=>{this.splitterModel.toString()!==[100,100,100].toString()&&(this.splitterModel=[100,100,100])}),100)}else if(2===$.numInstances){if(100===this.splitterModel[0]&&100===this.splitterModel[2])return;setTimeout((()=>{100===this.splitterModel[0]&&100===this.splitterModel[2]||(this.splitterModel[0]=100),this.splitterModel[2]=100;let e=this.splitterModel[1];this.splitterModel=[100,e,100]}),100)}else if(3===$.numInstances){if(100===this.splitterModel[2])return;setTimeout((()=>{100!==this.splitterModel[2]&&this.splitterModel.splice(2,1,100)}),100)}},deep:!0},"angelBot.numInstances":{handler(e){switch($.numInstances){case 1:this.splitterModel=[100,100,100];break;case 2:this.splitterModel=[100,50,100];break;case 3:this.splitterModel=[50,this.splitterModel[1],100];break;case 4:this.splitterModel=[this.splitterModel[0],this.splitterModel[1],50];break}},deep:!0}}},X=j,Z=(i("1d4c"),i("9989")),W=i("de5e"),H=Object(c["a"])(X,s,n,!1,null,null,null);t["default"]=H.exports;u()(H,"components",{QPage:Z["a"],QSplitter:D["a"],QBtn:h["a"],QPageSticky:W["a"]})},"78a7":function(e,t,i){"use strict";i.r(t);var s=i("9523"),n=i.n(s);i("ddb0"),i("4e82");const a=i("007b").default,o=new(i("faa1").EventEmitter);i("b234");class r extends a{constructor(e,t){super(),n()(this,"moveTimeout",null),n()(this,"axisRefreshTime",10),n()(this,"defaultVelocity",.1),n()(this,"plankThickness",18),n()(this,"vSlot",{length:80,width:80}),n()(this,"gantry",{verticalBarHeight:500}),n()(this,"bearings",{diameter:20}),n()(this,"plateDimensions",{thickness:5,length:300,width:100}),n()(this,"boltData",{M14:{headHeight:8.8,headDiameter:22,bodyDiameter:14}}),n()(this,"axes",{x:null,y:null,z:null}),n()(this,"limits",{x:{min:!1,max:!1},y:{min:!1,max:!1},z:{min:!1,max:!1}}),n()(this,"limitPositions",{x:{min:-1/0,max:1/0},y:{min:-1/0,max:1/0},z:{min:-1/0,max:1/0}}),n()(this,"xMin",null),n()(this,"xMax",null),n()(this,"position",{x:0,y:0,z:0}),n()(this,"plateFraction",.4),n()(this,"meshes",{}),n()(this,"movingX",!1),n()(this,"moveForward",(()=>this.moveRelativeXAxis(10))),n()(this,"moveBack",(()=>this.moveRelativeXAxis(-10))),n()(this,"moveRight",(()=>this.moveRelativeYAxis(10))),n()(this,"moveLeft",(()=>this.moveRelativeYAxis(-10))),n()(this,"moveUp",(()=>this.moveRelativeZAxis(10))),n()(this,"moveDown",(()=>this.moveRelativeZAxis(-10))),n()(this,"moveAbsolute",(e=>{this.moveAbsolute("X",e[0]),this.moveAbsolute("Y",e[1]),this.moveAbsolute("Z",e[2]),console.log("moving absolute",e)})),n()(this,"createGroundLegs",(()=>{let e=this.self,t=new BABYLON.TransformNode,i=new BABYLON.TransformNode,s=new BABYLON.TransformNode;try{for(let t in e.gantryVerticalLegMeshes)e.gantryVerticalLegMeshes[t].dispose()}catch(se){}let n=this.main.checkOnTable(e);n.soilTableLegsHeight;const a=BABYLON.MeshBuilder.CreateBox("verticalLeg1",{height:parseInt(e.plantHeight),width:e.legs.width,depth:e.legs.length});let o=this.main.soilDimensions(e),r=a.getBoundingInfo().boundingBox.minimumWorld.y;a.position.y+=e.topofBed-r;let l=a.clone("verticalLeg2");a.material=e.materials.aluminiumMaterial,a.position.x=-o.width/2+e.legs.width/2+e.legs.width,l.position.x=o.width/2-e.legs.width/2-e.legs.width;let m=o.width-2*e.legs.width,c=BABYLON.MeshBuilder.CreateBox("topBar1",{height:m,width:e.legs.width,depth:e.legs.length});c.rotation.x=Math.PI/2,c.rotation.z=Math.PI/2;let h=a.position.y+parseInt(e.plantHeight)/2+e.legs.width/2;c.position.y=h;let d=BABYLON.Mesh.MergeMeshes([a,l,c]);this.minOffsetYAxis=1.5*e.legs.width,d.parent=i;let u=d.clone(d);u.parent=s,u.material=e.materials.woodMaterial,this.meshes.gantryLeg1=d,this.meshes.gantryLeg2=u;let p=e.botWidth-2*e.legs.width,b=BABYLON.MeshBuilder.CreateBox("horizontalFrameLeg1",{height:m,width:e.legs.width,depth:e.legs.length}),g=BABYLON.MeshBuilder.CreateBox("horizontalFrameLeg2",{height:p,width:e.legs.width,depth:e.legs.length});b.material=e.materials.aluminiumMaterial,b.rotation.z=Math.PI/2,g.rotation.x=Math.PI/2,b.position.y=h+e.legs.width;let _=b.clone("horizontalFrameLeg3");b.position.z+=p/2+e.legs.width/2,_.position.z-=p/2+e.legs.width/2,g.position.y=h+e.legs.width;let y=g.clone("horizontalFrameLeg4");g.position.x+=m/2-e.legs.width/2,y.position.x-=m/2-e.legs.width/2;let f=b.clone("horizontalFrameBeam1"),x=_.clone("horizontalFrameBeam2"),v=e.legs.width+5,w=BABYLON.MeshBuilder.CreateCylinder("topBearing1",{height:v,diameter:e.legs.width}),B=BABYLON.MeshBuilder.CreateCylinder("coiledRope1",{height:v/4,diameter:e.legs.width+v/4*2,arc:.5,enclose:!0});w.material=e.materials.woodMaterial,w.position.y=h,B.material=e.materials.grassMaterial,B.position.y=h;let k=w.clone("topBearing1"),S=B.clone("coiledRope2");B.rotation.y=Math.PI,w.position.x+=m/4,B.position.z+=p/2+e.legs.width/2,k.position.x-=m/4,S.position.z-=p/2+e.legs.width/2;let O=BABYLON.Mesh.MergeMeshes([w,k]),M=BABYLON.Mesh.MergeMeshes([B,S]),T=O.clone("topBearing1B"),L=M.clone("coiledRope1B");O.position.z+=p/2+e.legs.width/2,M.position.x+=m/4,T.position.z-=p/2+e.legs.width/2,L.position.x-=m/4;let P=BABYLON.Mesh.MergeMeshes([O,T]),A=BABYLON.Mesh.MergeMeshes([M,L]);P.parent=t,A.parent=t,this.meshes.topBearing1All=P,this.meshes.coiledRopeAll=A,f.position.y-=v+e.legs.width,x.position.y-=v+e.legs.width;let N=BABYLON.MeshBuilder.CreateCylinder("coiledRope1",{height:p+e.legs.width,diameter:v/4});N.rotation.x=Math.PI/2,N.material=e.materials.grassMaterial,N.position.y=h;let I=v/4;N.position.x=-(m/4+e.legs.width/2+I/2);let Y=N.clone("rope2"),z=N.clone("rope3"),D=N.clone("rope4");Y.position.x+=e.legs.width+I,z.position.x=m/4+e.legs.width/2+I/2,D.position.x=m/4+e.legs.width/2+I/2-(e.legs.width+I);let C=BABYLON.Mesh.MergeMeshes([N,Y,z,D]);C.parent=t,this.meshes.allRopes=C;let E=BABYLON.MeshBuilder.CreateCylinder("hole1",{height:e.legs.width+5,diameter:1.5*I});E.rotation.x=Math.PI/2,E.material=e.materials.blackMaterial,E.position.y=h,E.position.x=Y.position.x,E.parent=s;let q=E.clone("hole2");q.position.x=N.position.x,q.parent=i;let R=E.clone("hole3");R.position.x=z.position.x,R.parent=i;let F=E.clone("hole4");F.position.x=D.position.x,F.parent=s,this.meshes.hole1=E,this.meshes.hole2=q,this.meshes.hole3=R,this.meshes.hole4=F;let G=BABYLON.MeshBuilder.CreateCylinder("knot1",{height:1.5*e.legs.width,diameterBottom:1*I,diameterTop:3*I});G.rotation.x=Math.PI/2;let V=G.clone("knot1A");V.rotation.y=-Math.PI,G.position.z-=e.legs.width/2,V.position.z+=e.legs.width/2,G=BABYLON.Mesh.MergeMeshes([G,V]),G.material=e.materials.sandMaterial,G.position.y=h,G.position.x=Y.position.x,G.parent=i;let $=G.clone("knot2");$.position.x=N.position.x,$.parent=s;let j=G.clone("knot3");j.position.x=z.position.x,j.parent=s;let X=G.clone("knot4");X.position.x=D.position.x,X.parent=i,this.meshes.knot1=G,this.meshes.knot2=$,this.meshes.knot3=j,this.meshes.knot4=X,this.xMin=this.minOffsetYAxis+e.legs.width/2,this.xMax=p/2+e.legs.width/2-1.5*e.legs.width,i.position.z=this.xMin,s.position.z=-this.xMin;let Z=BABYLON.MeshBuilder.CreateBox("bearingFlange",{height:v,width:e.legs.width,depth:e.legs.length});Z.position.y=h;let W=Z.clone("bearingFlange2");Z.position.z=p/2+e.legs.width/2,Z.position.x=m/2-e.legs.width/2,W.position.z=-(p/2+e.legs.width/2),W.position.x=m/2-e.legs.width/2;let H=Z.clone("bearingFlange3"),Q=W.clone("bearingFlange4");H.position.x=-(m/2-e.legs.width/2),Q.position.x=-(m/2-e.legs.width/2);let U=BABYLON.MeshBuilder.CreateBox("outerLeg1",{height:parseInt(e.plantHeight)-v,width:e.legs.width,depth:e.legs.length});r=U.getBoundingInfo().boundingBox.minimumWorld.y,U.position.y+=e.topofBed-r,U.position.z=p/2+e.legs.width/2,U.position.x=m/2-e.legs.width/2;let J=U.clone("outerLeg1");J.position.z=-(p/2+e.legs.width/2),J.position.x=m/2-e.legs.width/2;let K=U.clone("outerLeg3"),ee=J.clone("outerLeg4");K.position.x=-(m/2-e.legs.width/2),ee.position.x=-(m/2-e.legs.width/2);let te=BABYLON.MeshBuilder.CreateBox("topBarCentral",{height:m,width:e.legs.width,depth:e.legs.length});te.rotation.x=Math.PI/2,te.rotation.z=Math.PI/2,te.position.y=h+e.legs.width;let ie=BABYLON.Mesh.MergeMeshes([b,g,_,y,f,x,Z,W,H,Q,U,J,K,ee,te]);ie.parent=t,this.meshes.topFrame=ie,e.frontLeg=i,e.hindLeg=s,e.platformMain=t})),n()(this,"createLegs",(()=>{try{this.self.botTypeType.match(/ground/i)?this.createGroundLegs():this.createAerialLegs()}catch(e){}})),n()(this,"goHome",(async()=>{const e=async()=>new Promise((async(e,t)=>{await this.moveAbsolute("Z",this.limitPositions.z.max),e(!0)})),t=async()=>new Promise((async(e,t)=>{await this.moveAbsolute("Y",this.limitPositions.y.min),e(!0)})),i=async()=>new Promise((async(e,t)=>{await this.moveAbsolute("X",this.limitPositions.x.min),e(!0)}));await Promise.all([e(),t(),i()])})),n()(this,"emergencyStop",(()=>{o.emit("emergencyStopX"),o.emit("emergencyStopY"),o.emit("emergencyStopZ")})),n()(this,"destroy",(()=>{for(let e in this.meshes)this.meshes[e].dispose();this._destroy()})),this.self=e,this.main=t}create(){this.createGantry()}async createGantry(){if(!this.self.botTypeType)return;this.createLegs();const e=async()=>new Promise((async(e,t)=>{await this.getXAxisLimit("X",1),await this.getXAxisLimit("X",-1),e(!0)}));await Promise.all([e()]),this.self.enableExternalControls=!0}async getXAxisLimit(e,t){return new Promise(((e,i)=>{let s,n,a,r,l=this.self,{frontLeg:m,hindLeg:c,platformMain:h}=l,d="z",u=100,p=!0,b=!1,g=!1;s=this.meshes.topFrame.getBoundingInfo().boundingBox.maximumWorld[d],n=this.meshes.topFrame.getBoundingInfo().boundingBox.minimumWorld[d];let _=new BABYLON.Vector3(0,0,t*u),y=new BABYLON.Vector3(0,0,-t*u),f=new BABYLON.Vector3(0,0,1*t);r=i=>{if(!p){b=!1,o.removeListener("axisLimitX",r);let s="min";return 1===t&&(s="max"),this.limitPositions[i.axis.toLowerCase()][s]=h.position[d],e()}p=!1,b=!0},o.on("axisLimitX",r);const x=()=>{a=setTimeout((()=>{if(!p&&!b)return;b?(g||(h.position.addInPlace(y),m.position.addInPlace(y),c.position.addInPlace(y)),g=!0,h.position.addInPlace(f),h.position.addInPlace(f),h.position.addInPlace(f)):(h.position.addInPlace(_),m.position.addInPlace(_),c.position.addInPlace(_)),s=this.meshes.topFrame.getBoundingInfo().boundingBox.maximumWorld[d],n=this.meshes.topFrame.getBoundingInfo().boundingBox.minimumWorld[d];let e=l.soil.getBoundingInfo().boundingBox;e=[e.minimumWorld.z,e.maximumWorld.z],1===t&&s>=e[1]&&(_=new BABYLON.Vector3(0,0,-u-(s-e[1])),h.position.addInPlace(_),c.position.addInPlace(_),m.position.addInPlace(_),clearTimeout(a),p=!1,b=!1,o.emit("axisLimitX",{axis:"X",direction:"max"})),-1===t&&n<=e[0]&&(_=new BABYLON.Vector3(0,0,u-(n-e[0])),h.position.addInPlace(_),c.position.addInPlace(_),m.position.addInPlace(_),clearTimeout(a),p=!1,b=!1,o.emit("axisLimitX",{axis:"X",direction:"min"})),(p||b)&&x()}),10)};x()}))}async moveRelativeYAxis(e,t,i){}async moveRelativeXAxis(e,t,i,s){if(this.movingX)return!1;if(this.movingX=!0,0===Math.abs(e))return;let n,a,r,l=this.self,{frontLeg:m,hindLeg:c,platformMain:h}=l,d="z",u=h.position[d],p=(this.limitPositions.x.min,u-this.limitPositions.x.min),b=this.xMax-this.xMin,g=this.axisRefreshTime;return i||(i=t?e/t:this.defaultVelocity),s||(s=e/Math.abs(e)||-1),n=1e3*i,a=n/100*g,r=0===e?1/0:Math.abs(e),new Promise(((e,n)=>{let l,_,y,f;const x=()=>e(!0);y=e=>{this.movingX=!1,clearTimeout(l),o.removeListener("limitX",y),o.removeListener("stopX",f),x()},f=e=>{this.movingX=!1,clearTimeout(l),o.removeListener("limitX",y),o.removeListener("stopX",f),x()},o.once("limitX",y),o.once("stopX",f);const v=()=>{if(0===r)return o.emit("stopX",!0);u=h.position[d],p=u-this.limitPositions.x.min;let e=b-p%b;a=e,r>a?(t=g,_=a/2):(_=r,t=_/(1e3*i));this.meshes.topFrame.getBoundingInfo().boundingBox.minimumWorld.y,this.meshes.topFrame.getBoundingInfo().boundingBox.maximumWorld.y,this.meshes.topFrame.getBoundingInfo().boundingBox.minimumWorld.y,this.meshes.gantryLeg2.getBoundingInfo().boundingBox.minimumWorld.y,this.meshes.gantryLeg2.getBoundingInfo().boundingBox.maximumWorld.y,this.meshes.gantryLeg2.getBoundingInfo().boundingBox.minimumWorld.y,Math.floor(p/b);let n=h.position[d]+s*_;-1===s&&n<this.limitPositions.x.min?(_=Math.abs(h.position[d]-this.limitPositions.x.min),s=1,t=_/(1e3*i)):1===s&&n>this.limitPositions.x.max&&(_=Math.abs(h.position[d]-this.limitPositions.x.max),s=-1,t=_/(1e3*i)),l=setTimeout((()=>{u=h.position[d];let e=u-this.limitPositions.x.min,t=Math.floor(e/b);e>=0&&e<=this.limitPositions.x.max-this.limitPositions.x.min&&(t%2==0?m.position.addInPlace(new BABYLON.Vector3(0,0,2*s*_)):c.position.addInPlace(new BABYLON.Vector3(0,0,2*s*_)),h.position.addInPlace(new BABYLON.Vector3(0,0,s*_))),r-=_,v()}),t)};v()}))}async moveRelativeZAxis(e,t,i){if(0===Math.abs(e))return;let s,n,a,r=this.axisRefreshTime;return t||(t=this.defaultVelocity),i||(i=e/Math.abs(e)||-1),s=1e3*t,n=s/100*r,a=0===e?1/0:Math.abs(e),new Promise(((e,s)=>{let l,m,c,h,d;const u=()=>e(this.axes.z.position.y);h=e=>{clearTimeout(l),o.removeListener("limitZ",h),o.removeListener("stopZ",d),u()},d=e=>{clearTimeout(l),o.removeListener("limitZ",h),o.removeListener("stopZ",d),u()},o.once("limitZ",h),o.once("stopZ",d);const p=()=>{if(a<=0)return o.emit("stopZ",!0);a>n?(m=r,c=n):(c=a,m=c/(1e3*t));let e=this.axes.z.position.y+i*c;-1===i&&e<this.limitPositions.z.min?(c=Math.abs(this.axes.z.position.y-this.limitPositions.z.min),i=1,m=c/(1e3*t)):1===i&&e>this.limitPositions.z.max&&(c=Math.abs(this.axes.z.position.y-this.limitPositions.z.max),i=-1,m=c/(1e3*t)),l=setTimeout((()=>{this.axes.z.position.addInPlace(new BABYLON.Vector3(0,i*c,0)),a-=c,p()}),m)};p()}))}calculateMove(){clearInterval(this.moveTimeout),this.moveTimeout=setInterval((()=>{let e=this.self.joystick.speed||{};e=Object.values(e),e=e.sort(((e,t)=>t-e)).shift(),0===e&&(e=1);let{x:t,y:i,z:s}=this.self.joystick;if(Math.abs(t)+Math.abs(i)+Math.abs(s)===0)return void clearInterval(this.moveTimeout);let n=0,a=0,o=0;Math.abs(i)>0&&(n=i*Math.pow(2,e)),Math.abs(t)>0&&(a=t*Math.pow(2,e)),Math.abs(s)>0&&(o=s*Math.pow(2,e)),this.moveRelativeXAxis(n,100),this.moveRelativeYAxis(a),this.moveRelativeZAxis(o)}),100)}async moveAbsolute(e,t){return new Promise(((i,s)=>{let n,a,r,l,m,c,h,d=!0,u=!1,p=!1,b=100,g=this.self.joystick.speed||{};g=Object.values(g),g=g.sort(((e,t)=>t-e)).shift(),0===g&&(g=1),b=Math.pow(2,g);e.toLowerCase();switch(e){case"Z":case"z":r=this.axes.z,l="y";break;case"Y":case"y":r=this.axes.y,l="x";break;case"X":case"x":r=this.axes.x,l="z";break}let _=(t-r.position[l])/Math.abs(t-r.position[l]);if(n=t=>{clearTimeout(a),d=!1,u=!1,o.removeListener(`axisLimit${e}`,n),o.removeListener(`emergencyStop${e}`,n)},r.position[l]===t)return i();switch(e){case"Z":case"z":r=this.axes.z,l="y",m=new BABYLON.Vector3(0,_*b,0),h=new BABYLON.Vector3(0,-_*b,0),c=new BABYLON.Vector3(0,1*_,0);break;case"Y":case"y":r=this.axes.y,l="x",m=new BABYLON.Vector3(_*b,0,0),h=new BABYLON.Vector3(-_*b,0,0),c=new BABYLON.Vector3(1*_,0,0);break;case"X":case"x":r=this.axes.x,l="z",m=new BABYLON.Vector3(0,0,_*b),h=new BABYLON.Vector3(0,0,-_*b),c=new BABYLON.Vector3(0,0,1*_);break}o.on(`axisLimit${e}`,n),o.once(`emergencyStop${e}`,n);const y=()=>{a=setTimeout((()=>{if(!d&&!u)return;u?(p||r.position.addInPlace(h),p=!0,r.position.addInPlace(c)):r.position.addInPlace(m);let i=r.position[l];switch(e){case"Z":case"z":1===_&&i>=t&&(m=new BABYLON.Vector3(0,-b-(i-t),0),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisLimitZ",{axis:"Z",direction:"min"})),-1===_&&i<=t&&(m=new BABYLON.Vector3(0,b-(i-t),0),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisLimitZ",{axis:"Z",direction:"max"}));break;case"Y":case"y":1===_&&i>=t&&(m=new BABYLON.Vector3(-b-(i-t),0,0),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisLimitY",{axis:"Y",direction:"max"})),-1===_&&i<=t&&(m=new BABYLON.Vector3(b-(i-t),0,0),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisLimitY",{axis:"Y",direction:"min"}));break;case"X":case"x":1===_&&i>=t&&(m=new BABYLON.Vector3(0,0,-b-(i-t)),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisValue",{axis:"X",direction:"max"})),-1===_&&i<=t&&(m=new BABYLON.Vector3(0,0,b-(i-t)),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisValue",{axis:"X",direction:"min"}));break}(d||u)&&y()}),10)};y()}))}}t["default"]=r},"7db8":function(e,t,i){},"8d5f":function(e,t,i){"use strict";i.r(t);var s=i("9523"),n=i.n(s);const a=i("a41b").default,o=i("78a7").default;class r{constructor(e,t){n()(this,"bot",null),n()(this,"create",(()=>{let e=this.self;if(!e.botType||!e.botTypeType)return;let t=e.botType.toUpperCase();try{this.bot.destroy()}catch(i){}switch(t){case"FARMBOT":this.bot=new a(this.self,this.main);break;case"ANGELBOT":this.bot=new o(this.self,this.main);break}this.bot.create()})),n()(this,"moveAbsolute",((e,t)=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveAbsolute(e,t)})),n()(this,"moveRelative",((e,t)=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveRelative(e,t)})),n()(this,"moveForward",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveForward()})),n()(this,"moveBack",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveBack()})),n()(this,"moveLeft",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveLeft()})),n()(this,"moveRight",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveRight()})),n()(this,"moveUp",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveUp()})),n()(this,"moveDown",(()=>{if(!this.keyboardControlEnabled())return!1;this.bot.moveDown()})),this.self=e,this.main=t}keyboardControlEnabled(){return!!this.self.enableExternalControls}calculateMove(){if(!this.keyboardControlEnabled())return!1;this.bot.calculateMove()}goHome(){if(!this.keyboardControlEnabled())return!1;this.bot.goHome()}emergencyStop(){if(!this.keyboardControlEnabled())return!1;this.bot.emergencyStop()}}t["default"]=r},a41b:function(e,t,i){"use strict";i.r(t);var s=i("9523"),n=i.n(s);i("ddb0"),i("4e82");const a=i("007b").default,o=new(i("faa1").EventEmitter);class r extends a{constructor(e,t){super(),n()(this,"moveTimeout",null),n()(this,"axisRefreshTime",10),n()(this,"defaultVelocity",.1),n()(this,"plankThickness",18),n()(this,"vSlot",{length:80,width:80}),n()(this,"gantry",{verticalBarHeight:500}),n()(this,"bearings",{diameter:20}),n()(this,"plateDimensions",{thickness:5,length:300,width:100}),n()(this,"boltData",{M14:{headHeight:8.8,headDiameter:22,bodyDiameter:14}}),n()(this,"axes",{x:null,y:null,z:null}),n()(this,"limits",{x:{min:!1,max:!1},y:{min:!1,max:!1},z:{min:!1,max:!1}}),n()(this,"limitPositions",{x:{min:-1/0,max:1/0},y:{min:-1/0,max:1/0},z:{min:-1/0,max:1/0}}),n()(this,"position",{x:0,y:0,z:0}),n()(this,"plateFraction",.4),n()(this,"meshes",{}),n()(this,"moveForward",(()=>this.moveRelativeXAxis(10))),n()(this,"moveBack",(()=>this.moveRelativeXAxis(-10))),n()(this,"moveRight",(()=>this.moveRelativeYAxis(10))),n()(this,"moveLeft",(()=>this.moveRelativeYAxis(-10))),n()(this,"moveUp",(()=>this.moveRelativeZAxis(10))),n()(this,"moveDown",(()=>this.moveRelativeZAxis(-10))),n()(this,"reportPosition",(e=>{let t=this.axes.x.position.z-this.limitPositions.x.min,i=this.axes.y.position.x-this.limitPositions.y.min,s=this.limitPositions.z.max-this.axes.z.position.y;e([t,i,s])})),n()(this,"goHome",(async()=>{const e=async()=>new Promise((async(e,t)=>{await this.moveAbsolute_Old("Z",this.limitPositions.z.max),e(!0)})),t=async()=>new Promise((async(e,t)=>{await this.moveAbsolute_Old("Y",this.limitPositions.y.min),e(!0)})),i=async()=>new Promise((async(e,t)=>{await this.moveAbsolute_Old("X",this.limitPositions.x.min),e(!0)}));await Promise.all([e(),t(),i()])})),n()(this,"emergencyStop",(()=>{o.emit("emergencyStopX"),o.emit("emergencyStopY"),o.emit("emergencyStopZ")})),n()(this,"destroy",(()=>{for(let e in this.meshes)this.meshes[e].dispose();this._destroy()})),this.self=e,this.main=t}create(){this.createGantry()}async createGantry(){let e=this.self,t=BABYLON.MeshBuilder.CreateBox("bottomPlate",{height:this.plateDimensions.width,width:this.plateDimensions.length,depth:this.plateDimensions.thickness});t.position.y=this.plateDimensions.width/2,t.rotation.y=Math.PI/2;let i=BABYLON.MeshBuilder.CreateBox("topPlate",{height:this.plateDimensions.width,width:this.plateDimensions.length*this.plateFraction,depth:this.plateDimensions.thickness});i.rotation.y=Math.PI/2,i.position.y=this.plateDimensions.width/2+this.plateDimensions.width;let s=BABYLON.Mesh.MergeMeshes([t,i]);s.material=e.materials.aluminiumMaterial;let n=this.main.soilDimensions(e),a=this.main.checkOnTable(e),o=a.soilHolderHeight,r=e.planks.plank1.position.y+o/2-.5*this.plateDimensions.width+this.bearings.diameter/2;s.position.y=r;let l=s.clone("plate2");s.position.x=-this.plankThickness-n.width/2-this.plateDimensions.thickness/2-5,l.position.x=-(-this.plankThickness-n.width/2-this.plateDimensions.thickness/2-5);let m=BABYLON.MeshBuilder.CreateCylinder("bearing1",{height:this.plankThickness+5,diameter:this.bearings.diameter});m.rotation.z=Math.PI/2,m.position.y=this.bearings.diameter/2;let c=m.clone("bearing2"),h=m.clone("bearing3");h.position.y+=this.plateDimensions.width;let d=h.clone("bearing3");m.position.z=-.8*this.plateDimensions.length*.5,c.position.z=.8*this.plateDimensions.length*.5,h.position.z=-.8*this.plateFraction*this.plateDimensions.length*.5,d.position.z=.8*this.plateFraction*this.plateDimensions.length*.5;let u=BABYLON.Mesh.MergeMeshes([m,c,h,d]),p=e.planks.plank1.position.y+o/2;u.position.y=p,u.material=e.materials.woodMaterial;let b=u.clone("bearings2");u.position.x=-this.plankThickness-n.width/2-(this.plankThickness+5)+this.plankThickness,b.position.x=-(-this.plankThickness-n.width/2-(this.plankThickness+5)+this.plankThickness);let g=BABYLON.Mesh.MergeMeshes([u,b]);this.meshes.allBearings=g;let _=BABYLON.Mesh.MergeMeshes([s,l]);this.meshes.allPlates=_;let y=BABYLON.MeshBuilder.CreateBox("verticalGantryBar1",{height:parseInt(e.plantHeight),width:this.vSlot.length,depth:this.vSlot.width});y.material=e.materials.vSlotSideUpMaterial,y.position.y=parseInt(e.plantHeight)/2,y.rotation.y=Math.PI/2;let f=y.clone("verticalGantryBar2");y.position.x=-this.plankThickness-n.width/2-this.plateDimensions.thickness/2-5-this.plateDimensions.thickness/2-this.vSlot.length/2,f.position.x=-(-this.plankThickness-n.width/2-this.plateDimensions.thickness/2-5-this.plateDimensions.thickness/2-this.vSlot.length/2);let x=2*Math.abs(-this.plankThickness-n.width/2-this.plateDimensions.thickness/2-5-this.plateDimensions.thickness/2-this.vSlot.length)+2*this.vSlot.length,v=BABYLON.MeshBuilder.CreateBox("horizontalGantryBar",{height:this.vSlot.length,width:this.vSlot.width,depth:x});v.rotation.y=Math.PI/2,v.position.y+=this.vSlot.width/2+parseInt(e.plantHeight);let w=BABYLON.Mesh.MergeMeshes([y,f,v]);this.meshes.gantry=w,w.position.y=e.planks.plank1.position.y+o/2;let B=4*this.vSlot.length,k=BABYLON.MeshBuilder.CreateBox("electricalBox",{height:B,width:2*B/3,depth:B/3});this.meshes.electricalBox=k,k.material=e.materials.electricalBoxMaterial;const S=BABYLON.MeshBuilder.CreatePlane("farmBotLogo",{height:.5*B,width:2*B/3});this.meshes.farmBotLogo=S,S.material=e.materials.logoMaterial,S.position.z-=B/3/2+1;let O=new BABYLON.TransformNode;k.parent=O,S.parent=O,O.rotation.y=-Math.PI/2,O.position.x+=Math.abs(y.position.x)+this.vSlot.width,O.position.y=w.position.y+parseInt(e.plantHeight)/2;let M=400*this.vSlot.width,T=BABYLON.MeshBuilder.CreatePlane("yAxisEndStopLeft",{height:2*this.vSlot.width,width:M});this.meshes.yAxisEndStopLeft=T,T.material=e.materials.aluminiumMaterial,T.material.backFaceCulling=!1,T.checkCollisions=!0,T.position.y=w.position.y+parseInt(e.plantHeight),T.isVisible=!1,T.rotation.x=Math.PI/2;let L=T.clone("yAxisEndStopRight");this.meshes.yAxisEndStopRight=L,T.position.x=y.position.x+1+this.vSlot.width/2-M/2+5,L.position.x=f.position.x-1-this.vSlot.width/2+M/2-5;let P=new BABYLON.TransformNode;w.parent=P,O.parent=P,_.parent=P,g.parent=P,T.parent=P,L.parent=P;let A={height:this.vSlot.width+6*this.bearings.diameter,length:this.vSlot.width+8*this.bearings.diameter},N=BABYLON.MeshBuilder.CreateBox("box",{height:A.height,width:A.length,depth:this.plateDimensions.thickness});this.meshes.crossSlide=N,N.position.y+=A.height/2+w.position.y+parseInt(e.plantHeight)+this.vSlot.width-A.height/2-this.vSlot.width/2,N.position.z+=this.vSlot.width/2+5,N.material=e.materials.aluminiumMaterial;let I=this.vSlot.width+5,Y=BABYLON.MeshBuilder.CreateCylinder("bearing1",{height:I,diameter:this.bearings.diameter});Y.rotation.x=Math.PI/2,Y.position.y+=this.bearings.diameter/2,Y.material=e.materials.woodMaterial;let z=Y.clone("aBearing2"),D=Y.clone("aBearing3"),C=Y.clone("aBearing4");Y.position.z+=this.vSlot.width,z.position.z+=this.vSlot.width,Y.position.x=-(this.bearings.diameter/2+this.vSlot.width/2),z.position.x=this.bearings.diameter/2+this.vSlot.width/2;let E=Y.clone("aBearing5"),q=z.clone("aBearing6");E.position.y+=this.bearings.diameter+this.bearings.diameter+this.vSlot.width+this.bearings.diameter+this.bearings.diameter,q.position.y=E.position.y,D.position.x+=-(this.bearings.diameter+2*this.bearings.diameter+this.vSlot.width/2),C.position.x+=this.bearings.diameter+2*this.bearings.diameter+this.vSlot.width/2,D.position.y+=2*this.bearings.diameter,C.position.y+=2*this.bearings.diameter;let R=D.clone("aBearing7"),F=C.clone("aBearing8");R.position.y+=this.vSlot.width+this.bearings.diameter/2,F.position.y+=this.vSlot.width+this.bearings.diameter/2;let G=BABYLON.Mesh.MergeMeshes([Y,z,D,C,E,q,R,F]);this.meshes.allABearings=G,G.position.y=N.position.y-this.vSlot.width-this.bearings.diameter/2;let V=new BABYLON.TransformNode;N.parent=V,G.parent=V,V.checkCollisions=!0;let $=parseInt(e.plantHeight)+(A.height-this.vSlot.width)/2+this.vSlot.width,j=BABYLON.MeshBuilder.CreateBox("zAxis",{height:$,width:this.vSlot.length,depth:this.vSlot.width});this.meshes.zAxis=j,j.material=e.materials.vSlotSideMaterial,j.position.y=N.position.y+parseInt(e.plantHeight)/2-A.height,j.position.z=N.position.z+this.plateDimensions.thickness+5+this.vSlot.width/2;let X=BABYLON.MeshBuilder.CreatePlane("zAxisFace1",{height:this.vSlot.width,width:$});this.meshes.zAxisFace1=X,X.material=e.materials.vSlotSideMaterial,X.material.backFaceCulling=!1,X.rotation.z=Math.PI/2,X.position.y=j.position.y;let Z=X.clone("zAxisFace2");this.meshes.zAxisFace2=Z,X.position.z=j.position.z-this.vSlot.width/2-1,Z.position.z=j.position.z+this.vSlot.width/2+1;let W=400*this.vSlot.width,H=BABYLON.MeshBuilder.CreatePlane("zAxisEndStopTop",{height:W,width:2*this.vSlot.width});this.meshes.zAxisEndStopTop=H,H.position.z=j.position.z-this.vSlot.width+1,H.material=e.materials.aluminiumMaterial,H.rotation.y=Math.PI/2,H.checkCollisions=!0,H.isVisible=!1;let Q=H.clone("zAxisEndStopBottom");this.meshes.zAxisEndStopBottom=Q,H.position.y=j.position.y+$/2+W/2-5,Q.position.y=j.position.y-$/2-W/2+5;let U=new BABYLON.TransformNode;j.parent=U,H.parent=U,Q.parent=U,X.parent=U,Z.parent=U,this.axes.z=U;let J=new BABYLON.TransformNode;V.parent=J,U.parent=J,this.axes.y=J;let K=400*this.vSlot.width,ee=BABYLON.MeshBuilder.CreatePlane("xAxisEndStopFront",{height:2*this.vSlot.width,width:K});this.meshes.xAxisEndStopFront=ee,ee.material=e.materials.aluminiumMaterial,ee.checkCollisions=!0,ee.isVisible=!1,ee.position.x=l.position.x,ee.position.y=l.position.y+this.plateDimensions.width/2,ee.rotation.y=Math.PI/2,ee.rotation.x=Math.PI/2;let te=ee.clone("xAxisEndStopBack");this.meshes.xAxisEndStopBack=te,ee.position.z+=n.length/2+K/2-5,te.position.z+=-n.length/2-K/2+5;let ie=new BABYLON.TransformNode;J.parent=ie,P.parent=ie,this.axes.x=ie;const se=async()=>new Promise((async(e,t)=>{await this.getAxisLimit("Z",1),await this.getAxisLimit("Z",-1),e(!0)})),ne=async()=>new Promise((async(e,t)=>{await this.getAxisLimit("Y",1),await this.getAxisLimit("Y",-1),e(!0)})),ae=async()=>new Promise((async(e,t)=>{await this.getAxisLimit("X",1),await this.getAxisLimit("X",-1),e(!0)}));await Promise.all([se(),ne(),ae()]),await this.goHome(),e.enableExternalControls=!0,e.reallyShowPlants()}async getAxisLimit(e,t){return new Promise(((i,s)=>{let n,a,r,l,m,c,h,d,u=!0,p=!1,b=!1,g=100;e.toLowerCase();switch(n=s=>{if(!u){p=!1,o.removeListener(`axisLimit${e}`,n);let a="min";return 1===t&&(a="max"),this.limitPositions[s.axis.toLowerCase()][a]=r.position[l],i()}u=!1,p=!0},e){case"Z":case"z":r=this.axes.z,l="y",t*=-1,m=new BABYLON.Vector3(0,t*g,0),h=new BABYLON.Vector3(0,-t*g,0),c=new BABYLON.Vector3(0,1*t,0);break;case"Y":case"y":r=this.axes.y,l="x",m=new BABYLON.Vector3(t*g,0,0),h=new BABYLON.Vector3(-t*g,0,0),c=new BABYLON.Vector3(1*t,0,0);break;case"X":case"x":r=this.axes.x,l="z",m=new BABYLON.Vector3(0,0,t*g),h=new BABYLON.Vector3(0,0,-t*g),c=new BABYLON.Vector3(0,0,1*t);break}o.on(`axisLimit${e}`,n);const _=()=>{a=setTimeout((()=>{if(!u&&!p)return;let i;switch(p?(b||r.position.addInPlace(h),b=!0,r.position.addInPlace(c)):r.position.addInPlace(m),e){case"Z":case"z":i=this.meshes.zAxis.getBoundingInfo().boundingBox,i=[i.minimumWorld.y,i.maximumWorld.y],d=this.meshes.crossSlide.getBoundingInfo().boundingBox,d=[d.minimumWorld.y,d.maximumWorld.y],1===t&&i[0]>=d[0]&&(m=new BABYLON.Vector3(0,-g-(i[0]-d[0]),0),r.position.addInPlace(m),clearTimeout(a),u=!1,p=!1,o.emit("axisLimitZ",{axis:"Z",direction:"min"})),-1===t&&i[1]<=d[1]&&(m=new BABYLON.Vector3(0,g-(i[1]-d[1]),0),r.position.addInPlace(m),clearTimeout(a),u=!1,p=!1,o.emit("axisLimitZ",{axis:"Z",direction:"max"}));break;case"Y":case"y":i=this.meshes.crossSlide.getBoundingInfo().boundingBox,i=[i.minimumWorld.x,i.maximumWorld.x],1===t&&(d=this.meshes.yAxisEndStopRight.getBoundingInfo().boundingBox,d=[d.minimumWorld.x,d.maximumWorld.x],i[1]>=d[0]&&(m=new BABYLON.Vector3(-g-(i[1]-d[0]),0,0),r.position.addInPlace(m),clearTimeout(a),u=!1,p=!1,o.emit("axisLimitY",{axis:"Y",direction:"max"}))),-1===t&&(d=this.meshes.yAxisEndStopLeft.getBoundingInfo().boundingBox,d=[d.minimumWorld.x,d.maximumWorld.x],i[0]<=d[1]&&(m=new BABYLON.Vector3(g-(i[0]-d[1]),0,0),r.position.addInPlace(m),clearTimeout(a),u=!1,p=!1,o.emit("axisLimitY",{axis:"Y",direction:"min"})));break;case"X":case"x":i=this.meshes.allPlates.getBoundingInfo().boundingBox,i=[i.minimumWorld.z,i.maximumWorld.z],1===t&&(d=this.meshes.xAxisEndStopFront.getBoundingInfo().boundingBox,d=[d.minimumWorld.z,d.maximumWorld.z],i[1]>=d[0]&&(m=new BABYLON.Vector3(0,0,-g-(i[1]-d[0])),r.position.addInPlace(m),clearTimeout(a),u=!1,p=!1,o.emit("axisLimitX",{axis:"X",direction:"max"}))),-1===t&&(d=this.meshes.xAxisEndStopBack.getBoundingInfo().boundingBox,d=[d.minimumWorld.z,d.maximumWorld.z],i[0]<=d[1]&&(m=new BABYLON.Vector3(0,0,g-(i[0]-d[1])),r.position.addInPlace(m),clearTimeout(a),u=!1,p=!1,o.emit("axisLimitX",{axis:"X",direction:"min"})));break}(u||p)&&_()}),10)};_()}))}async moveRelativeYAxis(e,t,i,s){if(0===Math.abs(e))return;let n,a,r,l=this.axisRefreshTime;return i||(i=this.defaultVelocity),s||(s=e/Math.abs(e)||-1),n=1e3*i,a=n/100*l,r=0===e?1/0:Math.abs(e),new Promise(((e,n)=>{let m,c,h,d,u;const p=()=>e(this.axes.y.position.x);d=e=>{clearTimeout(m),1===s?this.limitPositions.y.max=this.axes.y.position.x:this.limitPositions.y.min=this.axes.y.position.x,o.removeListener("limitY",d),o.removeListener("stopY",u),t&&this.reportPosition(t),p()},u=e=>{clearTimeout(m),o.removeListener("limitY",d),o.removeListener("stopY",u),t&&this.reportPosition(t),p()},o.once("limitY",d),o.once("stopY",u);const b=()=>{if(r<=0)return o.emit("stopY",!0);r>a?(c=l,h=a):(h=r,c=h/(1e3*i));let e=this.axes.y.position.x+s*h;-1===s&&e<this.limitPositions.y.min?(h=Math.abs(this.axes.y.position.x-this.limitPositions.y.min),s=1,c=h/(1e3*i)):1===s&&e>this.limitPositions.y.max&&(h=Math.abs(this.axes.y.position.x-this.limitPositions.y.max),c=h/(1e3*i),s=-1),m=setTimeout((()=>{this.axes.y.position.addInPlace(new BABYLON.Vector3(s*h,0,0)),r-=h,b()}),c)};b()}))}async moveRelativeXAxis(e,t,i,s){if(0===Math.abs(e))return;let n,a,r,l=this.axisRefreshTime;return i||(i=this.defaultVelocity),s||(s=e/Math.abs(e)||-1),n=1e3*i,a=n/100*l,r=0===e?1/0:Math.abs(e),new Promise(((e,n)=>{let m,c,h,d,u;const p=()=>e(this.axes.x.position.z);d=e=>{clearTimeout(m),o.removeListener("limitX",d),o.removeListener("stopX",u),t&&this.reportPosition(t),p()},u=e=>{clearTimeout(m),o.removeListener("limitX",d),o.removeListener("stopX",u),t&&this.reportPosition(t),p()},o.once("limitX",d),o.once("stopX",u);const b=()=>{if(0===r)return o.emit("stopX",!0);r>a?(c=l,h=a):(h=r,c=h/(1e3*i));let e=this.axes.x.position.z+s*h;-1===s&&e<this.limitPositions.x.min?(h=Math.abs(this.axes.x.position.z-this.limitPositions.x.min),s=1,c=h/(1e3*i)):1===s&&e>this.limitPositions.x.max&&(h=Math.abs(this.axes.x.position.z-this.limitPositions.x.max),s=-1,c=h/(1e3*i)),m=setTimeout((()=>{this.axes.x.position.addInPlace(new BABYLON.Vector3(0,0,s*h)),r-=h,b()}),c)};b()}))}async moveRelativeZAxis(e,t,i,s){if(0===Math.abs(e))return;let n,a,r,l=this.axisRefreshTime;return i||(i=this.defaultVelocity),s||(s=e/Math.abs(e)||-1),n=1e3*i,a=n/100*l,r=0===e?1/0:Math.abs(e),new Promise(((e,n)=>{let m,c,h,d,u;const p=()=>e(this.axes.z.position.y);d=e=>{clearTimeout(m),o.removeListener("limitZ",d),o.removeListener("stopZ",u),t&&this.reportPosition(t),p()},u=e=>{clearTimeout(m),o.removeListener("limitZ",d),o.removeListener("stopZ",u),t&&this.reportPosition(t),p()},o.once("limitZ",d),o.once("stopZ",u);const b=()=>{if(r<=0)return o.emit("stopZ",!0);r>a?(c=l,h=a):(h=r,c=h/(1e3*i));let e=this.axes.z.position.y+s*h;-1===s&&e<this.limitPositions.z.min?(h=Math.abs(this.axes.z.position.y-this.limitPositions.z.min),s=1,c=h/(1e3*i)):1===s&&e>this.limitPositions.z.max&&(h=Math.abs(this.axes.z.position.y-this.limitPositions.z.max),s=-1,c=h/(1e3*i)),m=setTimeout((()=>{this.axes.z.position.addInPlace(new BABYLON.Vector3(0,s*h,0)),r-=h,b()}),c)};b()}))}calculateMove(){clearInterval(this.moveTimeout),this.moveTimeout=setInterval((()=>{let e=this.self.joystick.speed||{};e=Object.values(e),e=e.sort(((e,t)=>t-e)).shift(),0===e&&(e=1);let{x:t,y:i,z:s}=this.self.joystick;if(Math.abs(t)+Math.abs(i)+Math.abs(s)===0)return void clearInterval(this.moveTimeout);let n=0,a=0,o=0;Math.abs(i)>0&&(n=i*Math.pow(2,e)),Math.abs(t)>0&&(a=t*Math.pow(2,e)),Math.abs(s)>0&&(o=s*Math.pow(2,e)),this.moveRelativeXAxis(n),this.moveRelativeYAxis(a),this.moveRelativeZAxis(o)}),10)}async moveAbsolute(e,t){e=[e[1],e[0],e[2]];let i=this.axes.x.position.z-this.limitPositions.x.min,s=this.axes.y.position.x-this.limitPositions.y.min,n=this.limitPositions.z.max-this.axes.z.position.y,a=e[0]-i,o=e[1]-s,r=e[2]-n;this.moveRelative([o,a,-r],t)}async moveRelative(e,t){e=[e[1],e[0],e[2]];let i=this.axes.x.position.z-this.limitPositions.x.min,s=this.axes.y.position.x-this.limitPositions.y.min,n=this.limitPositions.z.max-this.axes.z.position.y,a=this.limitPositions.x.max-this.limitPositions.x.min,o=this.limitPositions.y.max-this.limitPositions.y.min,r=this.limitPositions.z.max-this.limitPositions.z.min,l=e.map((e=>e/Math.abs(e))),m=e[0],c=e[1],h=e[2];l.map(((e,t)=>{switch(t=parseInt(t),t){case 0:1===e?m>a-i&&(m=a-i):Math.abs(m)>i&&(m=-i);break;case 1:1===e?c>o-s&&(c=o-s):Math.abs(c)>s&&(c=-s);break;case 2:-1===e?Math.abs(h)>r-n&&(h=-(r-n)):(console.table({currentZ:n,z:h}),h>n&&(h=n),console.table({currentZ:n,z:h}));break}}));let d=[this.moveRelativeXAxis(m),this.moveRelativeYAxis(c),this.moveRelativeZAxis(h)];await Promise.all(d),t&&this.reportPosition(t)}async moveAbsolute_Old(e,t){return new Promise(((i,s)=>{let n,a,r,l,m,c,h,d=!0,u=!1,p=!1,b=100,g=this.self.joystick.speed||{};g=Object.values(g),g=g.sort(((e,t)=>t-e)).shift(),0===g&&(g=1),b=Math.pow(2,g);e.toLowerCase();switch(e){case"Z":case"z":r=this.axes.z,l="y";break;case"Y":case"y":r=this.axes.y,l="x";break;case"X":case"x":r=this.axes.x,l="z";break}let _=(t-r.position[l])/Math.abs(t-r.position[l]);if(console.log(t),n=t=>{clearTimeout(a),d=!1,u=!1,o.removeListener(`axisLimit${e}`,n),o.removeListener(`emergencyStop${e}`,n)},r.position[l]===t)return i();switch(e){case"Z":case"z":r=this.axes.z,l="y",m=new BABYLON.Vector3(0,_*b,0),h=new BABYLON.Vector3(0,-_*b,0),c=new BABYLON.Vector3(0,1*_,0);break;case"Y":case"y":r=this.axes.y,l="x",m=new BABYLON.Vector3(_*b,0,0),h=new BABYLON.Vector3(-_*b,0,0),c=new BABYLON.Vector3(1*_,0,0);break;case"X":case"x":r=this.axes.x,l="z",m=new BABYLON.Vector3(0,0,_*b),h=new BABYLON.Vector3(0,0,-_*b),c=new BABYLON.Vector3(0,0,1*_);break}o.on(`axisLimit${e}`,n),o.once(`emergencyStop${e}`,n);const y=()=>{a=setTimeout((()=>{if(!d&&!u)return;u?(p||r.position.addInPlace(h),p=!0,r.position.addInPlace(c)):r.position.addInPlace(m);let i=r.position[l];switch(e){case"Z":case"z":1===_&&i>=t&&(m=new BABYLON.Vector3(0,-b-(i-t),0),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisLimitZ",{axis:"Z",direction:"min"})),-1===_&&i<=t&&(m=new BABYLON.Vector3(0,b-(i-t),0),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisLimitZ",{axis:"Z",direction:"max"}));break;case"Y":case"y":1===_&&i>=t&&(m=new BABYLON.Vector3(-b-(i-t),0,0),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisLimitY",{axis:"Y",direction:"max"})),-1===_&&i<=t&&(m=new BABYLON.Vector3(b-(i-t),0,0),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisLimitY",{axis:"Y",direction:"min"}));break;case"X":case"x":1===_&&i>=t&&(m=new BABYLON.Vector3(0,0,-b-(i-t)),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisValue",{axis:"X",direction:"max"})),-1===_&&i<=t&&(m=new BABYLON.Vector3(0,0,b-(i-t)),r.position.addInPlace(m),clearTimeout(a),d=!1,u=!1,o.emit("axisValue",{axis:"X",direction:"min"}));break}(d||u)&&y()}),10)};y()}))}}t["default"]=r},e89a:function(e,t,i){"use strict";i("02ed")}}]);